"use strict";angular.module("rippleDemonstrator",["ngResource","ngTouch","ngAnimate","ui.router","ui.bootstrap","angular-loading-bar","growlNotifications","angularUtils.directives.dirPagination","ui.timepicker","ui.calendar","angularSpinner","mgcrea.ngStrap.popover"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("patients-list",{url:"/patients?ageRange&department&order&reverse",views:{main:{templateUrl:"views/patients/patients-list.html",controller:"PatientsListCtrl"}}}).state("patients-list-full",{url:"/patients-full-details?ageFrom&ageTo&orderType&pageNumber&reportType&searchString&queryType",views:{main:{templateUrl:"views/search/patients-list-full.html",controller:"PatientsListFullCtrl"}}}).state("patients-charts",{url:"/charts",views:{main:{templateUrl:"views/patients/patients-charts.html",controller:"PatientsChartsCtrl"}}}).state("patients-landing",{url:"/patients/{patientId:int}/patients-landing?patientSource&reportType&searchString&queryType",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/patients/patients-landing.html",controller:"PatientsLandingCtrl"}}}).state("main-search",{url:"/search",views:{main:{templateUrl:"views/main-search/main-search.html",controller:"MainSearchController"}}}).state("search-report",{url:"/search-report?searchString",views:{main:{templateUrl:"views/search/report-chart.html",controller:"ReportChartsCtrl"}}}).state("patients-lookup",{url:"/lookup",views:{actions:{templateUrl:"views/home-sidebar.html"},main:{controller:"PatientsLookupCtrl"}}}).state("patients-summary",{url:"/patients/{patientId:int}/patients-summary?patientSource&reportType&searchString&queryType",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/patients/patients-summary.html",controller:"PatientsSummaryCtrl"}}}).state("keyworkers-list",{url:"/patients/{patientId:int}/keyworkers?patientSource&reportType&searchString&queryType",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/keyworkers/keyworkers-list.html",controller:"KeyworkersListCtrl"}}}).state("keyworkers-detail",{url:"/patients/{patientId:int}/keyworkers/{keyworkerIndex}?patientSource&filter&page&reportType&searchString&queryType&source",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/keyworkers/keyworkers-list.html",controller:"KeyworkersListCtrl"},detail:{templateUrl:"views/keyworkers/keyworkers-detail.html",controller:"KeyworkersDetailCtrl"}}}).state("allergies",{url:"/patients/{patientId:int}/allergies?reportType&searchString&queryType",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/allergies/allergies-list.html",controller:"AllergiesListCtrl"}}}).state("allergies-detail",{url:"/patients/{patientId:int}/allergies/{allergyIndex}?filter&page&reportType&searchString&queryType",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/allergies/allergies-list.html",controller:"AllergiesListCtrl"},detail:{templateUrl:"views/allergies/allergies-detail.html",controller:"AllergiesDetailCtrl"}}}).state("medications",{url:"/patients/{patientId:int}/hscie-medications?patientSource&reportType&searchString&queryType",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/medications/medications-list.html",controller:"MedicationsListCtrl"}}}).state("medications-detail",{url:"/patients/{patientId:int}/hscie-medications/{medicationIndex}?patientSource&filter&page&reportType&searchString&queryType&source",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/medications/medications-list.html",controller:"MedicationsListCtrl"},detail:{templateUrl:"views/medications/medications-detail.html",controller:"MedicationsDetailCtrl"}}}).state("contacts-list",{url:"/patients/{patientId:int}/contacts?patientSource&reportType&searchString&queryType",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/contacts/contacts-list.html",controller:"ContactsListCtrl"}}}).state("contacts-detail",{url:"/patients/{patientId:int}/contacts/{contactIndex}?patientSource&filter&page&reportType&searchString&queryType&source",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/contacts/contacts-list.html",controller:"ContactsListCtrl"},detail:{templateUrl:"views/contacts/contacts-detail.html",controller:"ContactsDetailCtrl"}}}).state("problems-list",{url:"/patients/{patientId:int}/problems?patientSource&reportType&searchString&queryType",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/problems/problems-list.html",controller:"ProblemsListCtrl"}}}).state("problems-detail",{url:"/patients/{patientId:int}/problems/{problemIndex}?patientSource&filter&page&reportType&searchString&queryType&source",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/problems/problems-list.html",controller:"ProblemsListCtrl"},detail:{templateUrl:"views/problems/problems-detail.html",controller:"ProblemsDetailCtrl"}}}).state("transferOfCare",{url:"/patients/{patientId:int}/transfer?patientSource&reportType&searchString&queryType",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/transfer-of-care/transfer-of-care-list.html",controller:"TransferOfCareListCtrl"}}}).state("transferOfCare-detail",{url:"/patients/{patientId:int}/transfer/{transferIndex}?patientSource&filter&page&reportType&searchString&queryType&source",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/transfer-of-care/transfer-of-care-list.html",controller:"TransferOfCareListCtrl"},detail:{templateUrl:"views/transfer-of-care/transfer-of-care-detail.html",controller:"TransferOfCareDetailCtrl"}}}).state("transferOfCare-create",{url:"/patients/{patientId:int}/transfer-of-care-create?reportType&searchString&queryType",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{controller:"TransferOfCareCtrl"}}}).state("cancerMdt",{url:"/patients/{patientId:int}/cancer-mdt-list?reportType&searchString&queryType",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/cancer-mdt/cancermdt-list.html",controller:"CancerMdtListCtrl"}}}).state("cancerMdt-detail",{url:"/patients/{patientId:int}/cancer-mdt-detail/{cancerMdtIndex}?filter&page&reportType&searchString&queryType",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/cancer-mdt/cancermdt-list.html",controller:"CancerMdtListCtrl"},detail:{templateUrl:"views/cancer-mdt/cancer-mdt-detail.html",controller:"CancerMdtDetailCtrl"}}}).state("procedures",{url:"/patients/{patientId:int}/procedures?reportType&searchString&queryType",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/procedures/procedures-list.html",controller:"ProceduresListCtrl"}}}).state("procedures-detail",{url:"/patients/{patientId:int}/procedures/{procedureId}?filter&page&reportType&searchString&queryType&source",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/procedures/procedures-list.html",controller:"ProceduresListCtrl"},detail:{templateUrl:"views/procedures/procedures-detail.html",controller:"ProceduresDetailCtrl"}}}).state("referrals-list",{url:"/patients/{patientId:int}/referrals?patientSource&reportType&searchString&queryType",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/referrals/referrals-list.html",controller:"ReferralListCtrl"}}}).state("referrals-detail",{url:"/patients/{patientId:int}/referrals/{referralIndex}?patientSource&filter&page&reportType&searchString&queryType&source",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/referrals/referrals-list.html",controller:"ReferralListCtrl"},detail:{templateUrl:"views/referrals/referrals-detail.html",controller:"ReferralDetailCtrl"}}}).state("eolcareplans",{url:"/patients/{patientId:int}/eolcareplans?reportType&searchString&queryType",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/care-plans/eolcareplans-list.html",controller:"EolcareplansListCtrl"}}}).state("eolcareplans-detail",{url:"/patients/{patientId:int}/eolcareplans/{eolcareplansIndex}?filter&page&reportType&searchString&queryType",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/care-plans/eolcareplans-list.html",controller:"EolcareplansListCtrl"},detail:{templateUrl:"views/care-plans/eolcareplans-detail.html",controller:"EolcareplansDetailCtrl"}}}).state("appointments-list",{url:"/patients/{patientId:int}/appointments?patientSource&reportType&searchString&queryType",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/appointments/appointments-list.html",controller:"AppointmentListCtrl"}}}).state("appointments-detail",{url:"/patients/{patientId:int}/appointments/{appointmentIndex}?patientSource&filter&page&reportType&searchString&queryType&source",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/appointments/appointments-list.html",controller:"AppointmentListCtrl"},detail:{templateUrl:"views/appointments/appointments-detail.html",controller:"AppointmentDetailCtrl"}}}).state("orders",{url:"/patients/{patientId:int}/orders?reportType&searchString&queryType",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/orders/orders-list.html",controller:"OrdersListCtrl"}}}).state("orders-detail",{url:"/patients/{patientId:int}/orders/{orderId}?filter&page&reportType&searchString&queryType",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/orders/orders-list.html",controller:"OrdersListCtrl"},detail:{templateUrl:"views/orders/orders-detail.html",controller:"OrdersDetailCtrl"}}}).state("results",{url:"/patients/{patientId:int}/results?reportType&searchString&queryType",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/results/results-list.html",controller:"ResultsListCtrl"}}}).state("informationgov",{url:"/patients/{patientId:int}/consents?reportType&searchString&queryType",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/information-governance/information-governance-list.html",controller:"InformationGovernanceCtrl"}}}).state("informationgov-detail",{url:"/patients/{patientId:int}/consents/{consentId}?reportType&searchString&queryType",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/information-governance/information-governance-list.html",controller:"InformationGovernanceCtrl"},detail:{templateUrl:"views/information-governance/information-governance-detail.html",controller:"InformationGovernanceDetailCtrl"}}}).state("results-detail",{url:"/patients/{patientId:int}/results/{resultIndex}?filter&page&reportType&searchString&queryType",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/results/results-list.html",controller:"ResultsListCtrl"},detail:{templateUrl:"views/results/results-detail.html",controller:"ResultsDetailCtrl"}}}).state("images",{url:"/patients/{patientId:int}/images?filter&page&reportType&searchString&queryType",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/dicom/image-list.html",controller:"ImageListCtrl"}}}).state("images-detail",{url:"/patients/{patientId:int}/images/{studyId}?filter&page&reportType&searchString&queryType&source",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/dicom/image-list.html",controller:"ImageListCtrl"},detail:{templateUrl:"views/dicom/image-detail.html",controller:"ImageDetailCtrl"}}}).state("admin-console",{url:"/admin",views:{"user-context":{templateUrl:"views/admin/admin-context.html",controller:"AdminCtrl"},actions:{templateUrl:"views/admin/admin-sidebar.html",controller:"AdminCtrl"}}}).state("audits-by-patient",{url:"/audits/patient",views:{"user-context":{templateUrl:"views/admin/admin-context.html",controller:"AdminCtrl"},actions:{templateUrl:"views/admin/admin-sidebar.html",controller:"AdminCtrl"},main:{templateUrl:"views/audits/audit-list-by-patient.html",controller:"AuditListCtrl"},detail:{templateUrl:"views/audits/audit-detail.html",controller:"AuditDetailCtrl"}}}).state("audits-by-user",{url:"/audits/user",views:{"user-context":{templateUrl:"views/admin/admin-context.html",controller:"AdminCtrl"},actions:{templateUrl:"views/admin/admin-sidebar.html",controller:"AdminCtrl"},main:{templateUrl:"views/audits/audit-list-by-user.html",controller:"AuditListCtrl"},detail:{templateUrl:"views/audits/audit-detail.html",controller:"AuditDetailCtrl"}}}).state("alerts",{url:"/patients/{patientId:int}/alerts?filter&page",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/alerts/alerts-list.html",controller:"AlertsListCtrl"}}}).state("alerts-detail",{url:"/patients/{patientId:int}/alerts/{alertId}?filter&page&source",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/alerts/alerts-list.html",controller:"AlertsListCtrl"},detail:{templateUrl:"views/alerts/alerts-detail.html",controller:"AlertsDetailCtrl"}}})}]).directive("datepickerPopup",function(){return{restrict:"EAC",require:"ngModel",link:function(a,b,c,d){d.$formatters.unshift()}}}).directive("mySpace",function(){return function(a,b,c){b.bind("keydown keypress",function(b){32===b.which&&(a.$apply(function(){a.$eval(c.myEnter)}),b.preventDefault())})}}).directive("autoFocus",["$timeout",function(a){return{restrict:"A",require:"ngModel",scope:{ngModel:"="},link:function(b,c,d,e){b.$watch("ngModel",function(b){a(function(){c[0].focus()})})}}}]).directive("isValidNhsNumber",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){a.$watch(c.ngModel,function(a){e(a)}),d.$parsers.unshift(function(a){return e(a)});var e=function(a){if(a){var b=a.replace(/\s+/g,""),c=!isNaN(b)&&10===b.length;return d.$setValidity("invalidNHSNumFormat",c),c?b:""}}}}}).constant("keyCodes",{esc:27,enter:13,backspace:8,arrowUp:38,arrowDown:40,arrowRight:39,arrowLeft:37}).directive("keyBind",["keyCodes",function(a){function b(b){var c={};for(var d in b){var e=b[d];a.hasOwnProperty(d)&&(c[a[d]]=e)}return c}return function(a,c,d){var e=b(a.$eval(d.keyBind));c.bind("keydown keypress",function(b){e.hasOwnProperty(b.which)&&a.$apply(function(){a.$eval(e[b.which])})})}}]).directive("containsKeyCode",["keyCodes",function(a){return function(b){var c=!1;for(var d in a)a.hasOwnProperty(d)&&a[d]===b&&(c=!0);return c}}]).directive("focusElement",["$timeout",function(a){return{link:function(b,c,d){b.$watch(d.focusElement,function(b){a(function(){b===!0&&c.focus()})})}}}]).directive("rpOnLoad",["$parse",function(a){return function(b,c,d){var e=a(d.rpOnLoad);c.on("load",function(a){b.$apply(function(){e(b,{$event:a})})})}}]).filter("optedIn",function(){return function(a){return a?"Opted In":"Opted Out"}}).config(["datepickerConfig","datepickerPopupConfig","cfpLoadingBarProvider",function(a,b,c){a.startingDay=1,b.showButtonBar=!1,b.datepickerPopup="dd-MMM-yyyy",c.includeSpinner=!1}]).config(["paginationTemplateProvider",function(a){a.setPath("views/dirPagination.tpl.html")}]),angular.module("rippleDemonstrator").value("claims",{organisation:"hscie",scope:{homeView:"main-search",autoAdvancedSearch:!0,patientSummaryView:"landing",searchBarEnabled:!1,roleConfirmationRequired:!1,navBar:{patientSummaryEnabled:!0,alertsEnabled:!0,keyworkersEnabled:!0,contactsEnabled:!0,diagnosisEnabled:!0,problemsEnabled:!0,allergiesEnabled:!1,medicationsEnabled:!0,ordersEnabled:!1,resultsEnabled:!1,proceduresEnabled:!1,referralsEnabled:!0,appointmentsEnabled:!0,transfersEnabled:!0,careplansEnabled:!1,mdtEnabled:!1,imagesEnabled:!1,tagsEnabled:!1},patientSource:"tie"},tenant_name:"South Tyneside NHS Trust"}),angular.module("rippleDemonstrator").value("content",{idcr_title:"HSCIE Ripple",phr_title:"HSCIE Ripple",patientContextParams:{pasNumberLabel:"Other ID"}}),angular.module("rippleDemonstrator").factory("UserService",["$rootScope","$http","claims","content",function(a,b,c,d){var e=function(){return b.get("/api/user").then(function(b){var d=b.data;return d&&""!==d&&(d.tenant={id:b.data.tenant,name:c.tenant_name},d.isAuthenticated=!0,d.organisation=c.organisation,d.feature=c.scope,d.hasPermission=function(b){return a.currentUser.permissions.indexOf(b)>-1},b.data=d),b})},f=function(a){return d[a]},g=function(){return b.get("/api/logout")};return{findCurrentUser:e,getContent:f,logout:g}}]),angular.module("rippleDemonstrator").factory("Notifications",["$http",function(a){var b=function(){return a.get("/api/notifications/sources")},c=function(b){return a.post("/api/notifications/"+b+"/acknowledge")};return{all:b,acknowledge:c}}]),angular.module("rippleDemonstrator").factory("SearchInput",["$rootScope","$stateParams",function(a,b){var c=function(){"Setting: "===b.queryType?(a.searchMode=!0,a.settingsMode=!0,a.reportMode=!1,a.patientMode=!1,a.subHeader=b.queryType+b.searchString):"Reports: "===b.queryType?(a.searchMode=!0,a.reportMode=!0,a.settingsMode=!1,a.patientMode=!1,a.reportTypeSet=!0,a.reportTypeString=b.reportType,a.subHeader=b.queryType+b.reportType+": "+b.searchString+" & Aged "+b.ageFrom+" to "+b.ageTo):"Patient: "===b.queryType&&(a.searchMode=!0,a.reportMode=!1,a.settingsMode=!1,a.reportTypeSet=!1,a.patientMode=!0,a.subHeader=b.queryType+b.searchString)};return{update:c}}]),angular.module("rippleDemonstrator").factory("PatientService",["$http","Patient",function(a,b){var c=function(){return a.get("/api/patients").then(function(a){var c=[];return angular.forEach(a.data,function(a){a=new b(a),c.push(a)}),c})},d=function(c,d){return a.get("/api/patients/"+c+"?source="+d).then(function(a){return new b(a.data)})},e=function(b){var c={address1:b.address1,address2:b.address2,address3:b.address3,address4:b.address4,address5:b.address5,born:b.born,department:b.department,firstname:b.firstname,gPPractice:b.gPPractice,gender:b.gender,id:b.id,lastname:b.lastname,nhsNo:b.nhsNo,phone:b.phone,postCode:b.postCode,title:b.title};return a.put("/api/patients",c)},f=function(a,b){var c=_.findWhere(a.diagnoses,{id:b.id});angular.extend(c,b)},g=function(a,b,c){var d=a[b];a[b]=a[c],a[c]=d},h=function(){return c().then(function(a){var b={};return b.age=_.chain(a).filter(function(a){return!!a.age}).countBy(function(a){return a.ageRange}).map(function(a,b){return{series:b,value:a}}).reverse().value(),g(b.age,3,4),b.department=_.chain(a).filter(function(a){return!!a.department}).countBy(function(a){return a.department}).map(function(a,b){return{series:b,value:a}}).sortBy(function(a){return a.department}).value(),b})};return{all:c,get:d,update:f,summaries:h,create:e}}]),angular.module("rippleDemonstrator").factory("PatientSearchService",["$http",function(a){var b=function(b,c){return a.post("/api/patients/advancedSearch?source="+c,b)};return{searchPatients:b}}]),angular.module("rippleDemonstrator").factory("PatientLandingService",["$http",function(a){var b=function(b){return a.get("/api/patients/"+b+"/datasources").then(function(a){return a.data})};return{all:b}}]),angular.module("rippleDemonstrator").factory("Helper",["keyCodes",function(a){var b=function(a){var b=a.split("::"),c=parseInt(b[2])+1,d=b[0]+"::"+b[1]+"::"+c;return d},c=function(b){var c=!1;for(var d in a)a.hasOwnProperty(d)&&a[d]===b&&(c=!0);return c};return{updateId:b,containsKeyCode:c}}]),angular.module("rippleDemonstrator").factory("KeyworkersService",["$http",function(a){var b=function(b){return a.get("/api/patients/"+b+"/keyworkers")},c=function(b,c,d){return a.get("/api/patients/"+b+"/keyworkers/"+c+"?subSource="+d)};return{all:b,get:c}}]),angular.module("rippleDemonstrator").factory("ProblemsService",["$http",function(a){var b=function(b){return a.get("/api/hscie/patients/"+b+"/problems")},c=function(b,c,d){return a.get("/api/hscie/patients/"+b+"/problems/"+c+"?subSource="+d)};return{all:b,get:c}}]),angular.module("rippleDemonstrator").factory("Allergy",["$http",function(a){var b=function(b){return a.get("/api/patients/"+b+"/allergies")},c=function(b,c){return a.get("/api/patients/"+b+"/allergies/"+c)},d=function(b,c){return console.log("put allergy comp:"),console.log(c),a.post("/api/patients/"+b+"/allergies",c)},e=function(b,c){return console.log("put allergy comp:"),console.log(c),a.put("/api/patients/"+b+"/allergies",c)};return{all:b,get:c,update:e,create:d}}]),angular.module("rippleDemonstrator").factory("MedicationService",["$http",function(a){var b=function(b){return a.get("/api/hscie/patients/"+b+"/medications")},c=function(b,c,d){return a.get("/api/hscie/patients/"+b+"/medications/"+c+"?subSource="+d)};return{get:c,all:b}}]),angular.module("rippleDemonstrator").factory("ContactsService",["$http",function(a){var b=function(b){return a.get("/api/hscie/patients/"+b+"/contacts")},c=function(b,c,d){return a.get("/api/hscie/patients/"+b+"/contacts/"+c+"?subSource="+d)};return{all:b,get:c}}]),angular.module("rippleDemonstrator").factory("SmspLookup",["$http","Patient",function(a,b){var c=function(c,d){return a.post("/api/smsp-search",{firstname:c,lastname:d}).then(function(a){var c=[];return angular.forEach(a.data,function(a){a=new b(a),c.push(a)}),c})};return{byName:c}}]),angular.module("rippleDemonstrator").factory("TransferOfCareService",["$http",function(a){var b=function(b){return a.get("/api/patients/"+b+"/hscie-transfers")},c=function(b,c,d){return a.get("/api/patients/"+b+"/hscie-transfers/"+c+"?subSource="+d)};return{get:c,all:b}}]),angular.module("rippleDemonstrator").factory("CancerMdt",["$http",function(a){var b=function(b){return a.get("/api/patients/"+b+"/mdtreports/")},c=function(b,c){return a.get("/api/patients/"+b+"/mdtreports/"+c)},d=function(b,c){return console.log("create cancerMdtComposition: "),console.log(c),a.post("/api/patients/"+b+"/mdtreports",c)},e=function(b,c){return console.log("update cancerMdtComposition: "),console.log(c),a.put("/api/patients/"+b+"/mdtreports",c)};return{all:b,get:c,create:d,update:e}}]),angular.module("rippleDemonstrator").factory("AppointmentService",["$http",function(a){var b=function(b){return a.get("/api/hscie/patients/"+b+"/appointments")},c=function(b,c,d){return a.get("/api/hscie/patients/"+b+"/appointments/"+c+"?subSource="+d)};return{get:c,all:b}}]),angular.module("rippleDemonstrator").factory("ReferralService",["$http",function(a){var b=function(b){return a.get("/api/hscie/patients/"+b+"/referrals")},c=function(b,c,d){return a.get("/api/hscie/patients/"+b+"/referrals/"+c+"?subSource="+d)};return{get:c,all:b}}]),angular.module("rippleDemonstrator").factory("Eolcareplan",["$http",function(a){var b=function(b){return a.get("/api/patients/"+b+"/eolcareplans")},c=function(b,c){return a.get("/api/patients/"+b+"/eolcareplans/"+c)},d=function(b,c){return a.post("/api/patients/"+b+"/eolcareplans",c)},e=function(b,c){return a.put("/api/patients/"+b+"/eolcareplans",c)};return{all:b,get:c,update:e,create:d}}]),angular.module("rippleDemonstrator").factory("Procedure",["$http",function(a){var b=function(b){return a.get("/api/patients/"+b+"/procedures")},c=function(b,c,d){return a.get("/api/patients/"+b+"/procedures/"+c+"?source="+d)},d=function(b,c){return a.post("/api/patients/"+b+"/procedures",c)},e=function(b,c){return a.put("/api/patients/"+b+"/procedures",c)};return{all:b,get:c,update:e,create:d}}]),angular.module("rippleDemonstrator").factory("DateFormatter",function(){var a=function(a){return moment(a).format("YYYY-MM-DD")};return{clean:a}}),angular.module("rippleDemonstrator").factory("Result",["$http",function(a){var b=function(b,c){return a.get("/api/patients/"+b+"/labresults/"+c)},c=function(b){return a.get("/api/patients/"+b+"/labresults")};return{all:c,get:b}}]),angular.module("rippleDemonstrator").factory("Order",["$http",function(a){var b=function(b){return a.get("/api/patients/"+b+"/laborders")},c=function(b,c){return a.get("/api/patients/"+b+"/laborders/"+c)},d=function(b,c){return a.post("/api/patients/"+b+"/laborders",c)},e=function(){return a.get("/api/terminology/list/order")};return{all:b,get:c,create:d,suggestion:e}}]),angular.module("rippleDemonstrator").factory("Report",["$http",function(a){var b=function(b){return a.post("/api/search/reports/table",b)},c=function(b){return a.post("/api/search/setting/table",b)},d=function(b){return a.post("/api/search/reports/chart",b)},e=function(b){return a.post("/api/search/patient/table",b)};return{getChart:d,getTable:b,getSettingsTable:c,searchByPatient:e}}]),angular.module("rippleDemonstrator").factory("Image",["$http",function(a){var b=function(b){return a.get("/api/patients/"+b+"/dicom/studies")},c=function(b,c,d){return a.get("/api/patients/"+b+"/dicom/studies/"+c+"/series?source="+d)},d=function(b,c,d){return a.get("/api/patients/"+b+"/dicom/series/"+c+"?source="+d)},e=function(b,c,d){return a.get("/api/patients/"+b+"/dicom/series/"+c+"/instance?source="+d)},f=function(b,c,d){return a.get("/api/patients/"+b+"/dicom/instances/"+c+"?source="+d)};return{allStudies:b,getAllSeriesInStudy:c,getSeriesDetails:d,getInstanceId:e,getInstance:f}}]),angular.module("rippleDemonstrator").factory("AuditService",["$http","Audit",function(a,b){function c(a){var c=[];return angular.forEach(a,function(a){c.push(new b(a))}),c}var d=function(b,d){return a.get("/api/audit?patientId="+b+"&page="+d).then(function(a){return c(a.data)})},e=function(b,d){return a.get("/api/audit?username="+b+"&page="+d).then(function(a){return c(a.data)})},f=function(b){return a.get("/api/audit/count?patientId="+b)},g=function(b){return a.get("/api/audit/count?username="+b)},h=function(c){return a.get("/api/audit/"+c).then(function(a){return new b(a.data)})};return{allByPatient:d,allByUsername:e,countByPatient:f,countByUsername:g,get:h}}]),angular.module("rippleDemonstrator").factory("InformationGovernance",["$http",function(a){var b=function(b){return a.get("/api/patients/"+b+"/consents")},c=function(b,c){return a.get("/api/patients/"+b+"/consents/"+c)},d=function(b,c){return a.post("/api/patients/"+b+"/consents",c)},e=function(b,c){return a.put("/api/patients/"+b+"/consents",c)};return{all:b,get:c,update:e,create:d}}]),angular.module("rippleDemonstrator").factory("AdvancedSearch",["$modal","$http",function(a,b){var c=!0,d=function(b){if(c){c=!1;var d=a.open({templateUrl:"views/search/advanced-search-modal.html",size:"lg",controller:"AdvancedSearchController",resolve:{modal:function(){return{title:"Advanced Search"}},searchParams:function(){var a={};return isNaN(b)?a.surname=b:a.nhsNumber=b,a}}})}d.result.then(function(){c=!0},function(){c=!0})},e=function(a){return b.get("/api/patients/"+a)},f=function(a){return b.post("/api/patients/advancedSearch",a)};return{isModalClosed:c,openAdvancedSearch:d,searchByNhsNumber:e,searchByDetails:f}}]),angular.module("rippleDemonstrator").factory("AlertService",["$http",function(a){var b=function(b){return a.get("/api/patients/"+b+"/alerts");
},c=function(b,c){return a.get("/api/patients/"+b+"/alerts/"+c)},d=function(b,c){return a.post("/api/patients/"+b+"/alerts",c)},e=function(b,c){return a.put("/api/patients/"+b+"/alerts",c)};return{findAllSummaries:b,findDetails:c,update:e,create:d}}]),angular.module("rippleDemonstrator").factory("Patient",["$window",function(a){var b=function(b){var c=this;_.extend(this,b),c.age=function(){return a.moment().diff(c.dateOfBirth,"years")},c.optIn="undefined"==typeof b.optIn?!0:b.optIn,c.ageRange=function(){var a=c.age();switch(!0){case a>=0&&10>=a:return"0-10";case a>=11&&18>=a:return"11-18";case a>=19&&30>=a:return"19-30";case a>=31&&60>=a:return"31-60";case a>=60&&80>=a:return"60-80";case a>80:return">80";default:return}}()};return b}]),angular.module("rippleDemonstrator").factory("Audit",["$window",function(a){var b=function(a){var b=this;_.extend(this,a),b.requesterAction=c(a.action)},c=function(a){var b;switch(a){case"CREATE":b="Create";break;case"UPDATE":b="Edit";break;case"READ":b="View";break;case"NULL":b="Unknown";break;default:b="Unknown"}return b};return b}]),angular.module("rippleDemonstrator").controller("PatientsListCtrl",["$scope","$state","$stateParams","PatientService",function(a,b,c,d){d.all().then(function(b){a.patients=b}),a.order=c.order||"name",a.reverse="true"===c.reverse,a.filters={department:c.department,ageRange:c.ageRange},a.sort=function(d){var e=a.reverse;a.order===d&&(e=!e),b.transitionTo(b.current,_.extend(c,{order:d,reverse:e}))},a.sortClass=function(b){return a.order===b?a.reverse?"sort-desc":"sort-asc":void 0},a.go=function(a){b.go("patients-summary",{patientId:a.id})},a.patientFilter=function(b){return a.filters.department?b.department===a.filters.department:a.filters.ageRange?b.ageRange===a.filters.ageRange:!0}}]),angular.module("rippleDemonstrator").controller("headerController",["$scope","$rootScope","$state","$window","usSpinnerService","$stateParams","UserService","AdvancedSearch","Helper",function(a,b,c,d,e,f,g,h,i){b.searchExpression="",a.searchExpression=b.searchExpression,a.reportTypes=[],a.searchFocused=!1;var j;g.findCurrentUser().then(function(e){if(j=e.headers().location)d.location=j;else switch(b.currentUser=e.data,a.autoAdvancedSearch=b.currentUser.feature.autoAdvancedSearch,a.searchBarEnabled=!1,a.navBar=b.currentUser.feature.navBar,b.currentUser.role){case"IDCR":c.go("main-search");break;case"PHR":c.go("patients-summary",{patientId:b.currentUser.nhsNumber});break;default:c.go("main-search")}}),a.logout=function(){g.logout().then(function(a){j=a.headers().location,j&&(d.location=j)})},b.$on("$stateChangeSuccess",function(d,e){var g=f,i="",j="",k="",l=0,m=0;switch(e.name){case"main-search":i="",j="Welcome",k="",l=12,m=0;break;case"patients-list":i="patients-charts",j="Patient Lists",k="Patient Dashboard",l=12,m=0;break;case"patients-charts":i="",j="Patient Dashboard",k="",l=12,m=0;break;case"patients-search":i="",j="Patient Dashboard",k="",l=12,m=0;break;case"patients-landing":i="patients-search",j="Patient Summary",k="Patient Search",l=12,m=0;break;case"patients-summary":i="patients-list",j="Patient Summary",k="Patient Lists",l=12,m=0;break;case"patients-lookup":i="",j="Patients lookup",k="",l=6,m=6;break;case"search-report":i="patients-charts",j="Report Search",k="Patient Dashboard",l=12,m=0;break;case"patients-list-full":i="patients-charts",j="Patients Details",k="Patient Dashboard",l=12,m=0;break;case"audits-by-patient":i="",j="Admin Console",k="",l=6,m=6;break;case"audits-by-user":i="",j="Admin Console",k="",l=6,m=6;break;case"admin-console":i="",j="Admin Console",k="",l=6,m=6;break;default:i="patients-list",j="Patients Details",k="Patient Lists",l=6,m=6}"Reports: "===g.queryType&&(i="search-report",k="Report Chart"),a.containsReportString=function(){return 0===a.searchExpression.indexOf("rp ")},a.containsSettingString=function(){return 0===a.searchExpression.lastIndexOf("st ")},a.containsPatientString=function(){return 0===a.searchExpression.lastIndexOf("pt ")},a.containsReportTypeString=function(){for(var b=0;b<a.reportTypes.length;b++)if(-1!==a.searchExpression.lastIndexOf(a.reportTypes[b]))return!0;return!1},b.searchMode=!1,b.reportMode=!1,b.settingsMode=!1,b.patientMode=!1,b.reportTypeSet=!1,b.reportTypeString="",a.checkExpression=function(){a.autoAdvancedSearch?a.searchExpression.length>=3&&h.openAdvancedSearch(a.searchExpression):b.searchMode?(b.reportMode&&!b.reportTypeSet&&(a.reportTypes=["Diagnosis: ","Orders: "]),a.containsReportTypeString()&&!a.patientMode&&(b.reportTypeSet=!0,a.processReportTypeMode())):(a.reportTypes=[],b.searchMode=a.containsReportString()||a.containsSettingString()||a.containsPatientString(),b.reportMode=a.containsReportString(),b.settingsMode=a.containsSettingString(),b.patientMode=a.containsPatientString(),b.reportMode&&(a.containsReportTypeString&&a.processReportTypeMode(),a.processReportMode()),b.settingsMode&&a.processSettingMode(),b.patientMode&&a.processPatientMode())},a.cancelSearchMode=function(){b.reportMode=!1,b.searchMode=!1,b.patientMode=!1,b.settingsMode=!1,a.searchExpression="",a.reportTypes="",b.reportTypeSet=!1,b.reportTypeString=""},a.cancelReportType=function(){b.reportTypeString="",b.reportTypeSet=!1},a.searchFunction=function(){if(a.autoAdvancedSearch&&h.openAdvancedSearch(),b.reportTypeSet&&""!==a.searchExpression){var d=b.reportTypeString+": "+a.searchExpression;c.go("search-report",{searchString:d})}b.settingsMode&&""!==a.searchExpression&&c.go("patients-list-full",{queryType:"Setting: ",searchString:a.searchExpression,orderType:"ASC",pageNumber:"1"}),b.patientMode&&""!==a.searchExpression&&c.go("patients-list-full",{queryType:"Patient: ",searchString:a.searchExpression,orderType:"ASC",pageNumber:"1"})},a.processReportMode=function(){"rp "===a.searchExpression&&(a.searchExpression="")},a.processReportTypeMode=function(){for(var c=0;c<a.reportTypes.length;c++)if(-1!==a.searchExpression.lastIndexOf(a.reportTypes[c])){var d=a.searchExpression.split(":");b.reportTypeString=d[0],b.reportTypeSet=!0,a.searchExpression=""}a.reportTypes=[]},a.processSettingMode=function(){"st "===a.searchExpression&&(a.searchExpression="")},a.processPatientMode=function(){"pt "===a.searchExpression&&(a.searchExpression="")},"undefined"==typeof f.ageFrom&&(i="patients-list",k="Patient Lists"),a.pageHeader=j,a.previousState=i,a.previousPage=k,a.backButtonEnabled="main-search"!==a.currentUser.feature.homeView,a.mainWidth=l,a.detailWidth=m,a.searchBarEnabled=!c.is("main-search"),a.goBack=function(){history.back()},a.footer="Integrated Digital Care Record",a.userContextViewExists="user-context"in c.current.views,a.actionsExists="actions"in c.current.views,a.go=function(a){c.go("patients-summary",{patientId:a.id})},("IDCR"===a.currentUser.role||"IG"===a.currentUser.role)&&(a.title="HSCIE Ripple"),"PHR"===a.currentUser.role&&(a.title="PHR POC"),a.goHome=function(){a.cancelSearchMode(),("IDCR"===a.currentUser.role||"IG"===a.currentUser.role)&&c.go("main-search"),"PHR"===a.currentUser.role&&c.go("patients-summary",{patientId:10})},a.goToAdminConsole=function(){c.go("admin-console")}}),a.openAdvancedSearch=h.openAdvancedSearch,a.$on("toggleHeaderSearchEnabled",function(b,c){a.searchBarEnabled=c})}]),angular.module("rippleDemonstrator").controller("PatientsChartsCtrl",["$scope","$window","$state","PatientService","$modal","UserService",function(a,b,c,d,e,f){f.findCurrentUser().then(function(b){a.currentUser=b.data,a.proceed=function(b,c){a.currentUser.feature.roleConfirmationRequired?g(b,c):h(b,c)}});var g=function(a,b){e.open({templateUrl:"views/confirmation.html",size:"md",controller:["$scope",function(a){a.cancel=function(){a.$close(!0)},a.ok=function(b,c){a.$close(!0),h(b,c)}}]})},h=function(a,b){switch(b){case"all":c.go("patients-list");break;case"age":c.go("patients-list",{ageRange:a.series});break;case"summary":"All"===a.series&&(a.series=null),c.go("patients-list",{department:a.series});break;default:c.go("patients-list")}},i=function(c){b.Morris.Bar({element:"age-chart",resize:!0,data:c.age,ykeys:["value"],xkey:"series",labels:["Patients"],barColors:["#7E28CD"],ymin:0,ymax:46,barGap:4,barSizeRatio:.55,xLabelAngle:50,redraw:!0}).on("click",function(b,c){var d="age";a.proceed(c,d)})},j=function(c){b.Morris.Bar({element:"department-chart",resize:!0,data:c.department,ykeys:["value"],xkey:"series",labels:["Patients"],hideHover:!0,barColors:["#25A174"],ymin:0,ymax:40,barGap:4,barSizeRatio:.55,xLabelAngle:50,redraw:!0}).on("click",function(b,c){var d="summary";a.proceed(c,d)})};$(".chart-inner select").change(function(){var a=$(this).val();$(this).closest(".chart-inner").find(".chart").each(function(){$(this).attr("id")===a?$(this).show():$(this).hide()})}),a.toggleChart=function(){$("#age-chart").empty(),$("#department-chart").empty(),$("#age-chart").off("click"),$("#department-chart").off("click"),"age"===a.selectedChart?d.summaries().then(function(a){i(a)}):d.summaries().then(function(a){j(a)})},a.selectedChart="age",a.toggleChart()}]),angular.module("rippleDemonstrator").controller("PatientsSearchCtrl",["$scope","$stateParams","$window","$state","PatientSearchService","usSpinnerService","UserService",function(a,b,c,d,e,f,g){a.searching=!1,g.findCurrentUser().then(function(c){a.currentUser=c.data,b.patientSource=a.currentUser.feature.patientSource}),a.dateOfBirthDatePicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.searchPatients=function(b){f.spin("patientSearch-spinner"),a.formSubmitted=!0,a.patientSearchForm.$valid=!0,a.searching=!0,void 0!=b&&e.searchPatients(b,"TIE").then(function(b){a.patients=b.data}),a.searching=!1,f.stop("patientSearch-spinner")},a.sort=function(){"ASC"===b.orderType?b.orderType="DESC":b.orderType="ASC",b.pageNumber=1,getData()},a.go=function(a){d.go("patients-landing",{patientId:a.nhsNumber,reportType:b.reportType,searchString:b.searchString,queryType:b.queryType,patientSource:b.patientSource})}}]),angular.module("rippleDemonstrator").controller("PatientsLandingCtrl",["$scope","$stateParams","PatientLandingService","PatientService","UserService",function(a,b,c,d,e){d.get(b.patientId,"tie").then(function(b){a.patient=b}),e.findCurrentUser().then(function(c){a.currentUser=c.data,b.patientSource=a.currentUser.feature.patientSource}),c.all(b.patientId).then(function(b){a.datasources=b})}]),angular.module("rippleDemonstrator").controller("PatientsLookupCtrl",["$modal","$state",function(a,b){a.open({templateUrl:"views/patients/patients-lookup.html",size:"lg",controller:["$scope","SmspLookup","PatientService",function(a,b,c){a.search=function(c,d){a.searching=!0,b.byName(c,d).then(function(b){a.patients=b,a.searching=!1},function(){a.searching=!1})},a.create=function(b){c.create(b).then(function(){a.save()})},a.dismiss=function(){a.$dismiss()},a.save=function(){a.$close(!0)}}]}).result["finally"](function(){b.go("patients-charts")})}]),angular.module("rippleDemonstrator").controller("PatientsSummaryCtrl",["$scope","$stateParams","$state","SearchInput","$rootScope","$location","usSpinnerService","PatientService","UserService",function(a,b,c,d,e,f,g,h,i){d.update(),i.findCurrentUser().then(function(c){a.currentUser=c.data,b.patientSource=a.currentUser.feature.patientSource}),h.get(b.patientId,b.patientSource).then(function(b){a.patient=b,a.isOptedOut=!a.patient.optIn,g.stop("patientSummary-spinner")}),a.go=function(a){f.path(a)},a.goToSection=function(a){var d={patientId:b.patientId,reportType:b.reportType,searchString:b.searchString,queryType:b.queryType,patientSource:b.patientSource},e="";switch(a){case"Problems":e="diagnoses-list";break;case"Allergies":e="allergies";break;case"Medications":e="medications";break;case"Contacts":e="contacts";break;case"Transfer":e="transferOfCare"}c.go(e,d)}}]),angular.module("rippleDemonstrator").controller("PatientsDetailCtrl",["$scope","$stateParams","$state","SearchInput","PatientService","UserService",function(a,b,c,d,e,f){d.update(),e.get(b.patientId,b.patientSource).then(function(b){a.patient=b}),f.findCurrentUser().then(function(c){a.currentUser=c.data,b.patientSource=a.currentUser.feature.patientSource;var d=f.getContent("patientContextParams");a.pasNumberLabel=d.pasNumberLabel}),a.goTo=function(a){var d={patientId:b.patientId,reportType:b.reportType,searchString:b.searchString,queryType:b.queryType,patientSource:b.patientSource},e="";switch(a){case"summary":e="patients-summary";break;case"alerts":e="alerts";break;case"keyworkers":e="keyworkers-list";break;case"contacts":e="contacts-list";break;case"problems":e="problems-list";break;case"allergies":e="allergies";break;case"medications":e="medications";break;case"orders":e="orders";break;case"results":e="results";break;case"procedures":e="procedures";break;case"referrals":e="referrals-list";break;case"appointments":e="appointments-list";break;case"transfers":e="transferOfCare";break;case"careplans":e="eolcareplans";break;case"mdt":e="cancerMdt";break;case"images":e="images";break;case"informationgov":e="informationgov"}c.go(e,d)}}]),angular.module("rippleDemonstrator").controller("KeyworkersListCtrl",["$scope","$filter","$state","$stateParams","SearchInput","$location","$modal","usSpinnerService","PatientService","KeyworkersService","UserService",function(a,b,c,d,e,f,g,h,i,j,k){e.update(),a.currentPage=1,k.findCurrentUser().then(function(b){a.currentUser=b.data,d.patientSource=a.currentUser.feature.patientSource}),a.pageChangeHandler=function(b){a.currentPage=b},d.page&&(a.currentPage=d.page),a.search=function(b){return-1!==angular.lowercase(b.name).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.role).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.contactNumber).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.source).indexOf(angular.lowercase(a.query)||"")},d.filter&&(a.query=d.filter),i.get(d.patientId,d.patientSource).then(function(b){a.patient=b}),j.all(d.patientId).then(function(b){a.keyworkers=b.data,h.stop("patientSummary-spinner")}),a.go=function(b,e){c.go("keyworkers-detail",{patientId:a.patient.nhsNumber,keyworkerIndex:b,filter:a.query,page:a.currentPage,reportType:d.reportType,searchString:d.searchString,queryType:d.queryType,source:e,patientSource:d.patientSource})},a.selected=function(a){return a===d.keyworkerIndex},a.countKeyContact=function(c,d){var e=b("filter")(a.keyworkers,{role:"ADMISSION - Key Contact"}),f=b("filter")(a.keyworkers,{role:"DISCHARGE - Key Contact"}),g=e.length-1,h=f.length-1;return g!=h&&"OUTPATIENTS - Key Contact"==c.role?!1:!0},a.hideKeyContact=function(a){return a.role.indexOf("Key Contact")>-1?!1:!0},a.showKeyContact=function(a){return a.role.indexOf(" - Key Contact")>-1?!0:!1}}]),angular.module("rippleDemonstrator").controller("KeyworkersDetailCtrl",["$scope","$stateParams","SearchInput","$location","$modal","Helper","$state","usSpinnerService","PatientService","KeyworkersService",function(a,b,c,d,e,f,g,h,i,j){c.update(),a.UnlockedSources=["handi.ehrscape.com"],i.get(b.patientId).then(function(b){a.patient=b}),j.get(b.patientId,b.keyworkerIndex,b.source).then(function(b){a.keyworker=b.data,h.stop("keyworkerDetail-spinner")}),a.isLocked=function(b){if(!b||!b.id)return!0;var c=b.id.toString().split("::");return c.length>1?a.UnlockedSources.indexOf(c[1])<0:!0},a.convertToLabel=function(a){var b=a.replace(/([A-Z])/g," $1");return b.charAt(0).toUpperCase()+b.slice(1)}}]),angular.module("rippleDemonstrator").controller("ProblemsListCtrl",["$scope","$filter","$state","$stateParams","SearchInput","$location","$modal","usSpinnerService","PatientService","ProblemsService","UserService",function(a,b,c,d,e,f,g,h,i,j,k){e.update(),a.currentPage=1,k.findCurrentUser().then(function(b){a.currentUser=b.data,d.patientSource=a.currentUser.feature.patientSource}),a.pageChangeHandler=function(b){a.currentPage=b},d.page&&(a.currentPage=d.page),a.search=function(c){var d=b("date")(c.dateOfOnset,"dd/MM/yyyy HH:mm");return-1!==angular.lowercase(c.problem).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(d).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(c.sourceId).indexOf(angular.lowercase(a.query)||"")},d.filter&&(a.query=d.filter),i.get(d.patientId,d.patientSource).then(function(b){a.patient=b}),j.all(d.patientId).then(function(b){a.problems=b.data,h.stop("patientSummary-spinner")}),a.go=function(b,e){c.go("problems-detail",{patientId:a.patient.nhsNumber,problemIndex:b,filter:a.query,page:a.currentPage,reportType:d.reportType,searchString:d.searchString,queryType:d.queryType,source:e,patientSource:d.patientSource})},a.selected=function(a){return a===d.problemIndex}}]),angular.module("rippleDemonstrator").controller("ProblemsDetailCtrl",["$scope","$stateParams","SearchInput","$location","$modal","Helper","$state","usSpinnerService","PatientService","ProblemsService",function(a,b,c,d,e,f,g,h,i,j){c.update(),a.UnlockedSources=["handi.ehrscape.com"],i.get(b.patientId).then(function(b){a.patient=b}),j.get(b.patientId,b.problemIndex,b.source).then(function(b){a.problem=b.data,h.stop("problemDetail-spinner")}),a.isLocked=function(b){if(!b||!b.id)return!0;var c=b.id.toString().split("::");return c.length>1?a.UnlockedSources.indexOf(c[1])<0:!0},a.convertToLabel=function(a){var b=a.replace(/([A-Z])/g," $1");return b.charAt(0).toUpperCase()+b.slice(1)}}]),angular.module("rippleDemonstrator").controller("DiagnosesModalCtrl",["$scope","$modalInstance","UserService","diagnosis","patient","modal",function(a,b,c,d,e,f){c.findCurrentUser().then(function(b){a.currentUser=b.data}),a.diagnosis=d,a.patient=e,a.modal=f,a.protocol="http://","Edit Problem / Diagnosis"===f.title?(a.diagnosis.dateSubmitted=(new Date).toISOString().slice(0,10),a.diagnosis.dateOfOnset=new Date(a.diagnosis.dateOfOnset).toISOString().slice(0,10)):(a.diagnosis.dateSubmitted=(new Date).toISOString().slice(0,10),a.diagnosis.code="12393890"),a.changeProtocol=function(b){switch(b){case"http":a.protocol="http://";break;case"https":a.protocol="https://";break;default:a.protocol="http://"}},a.ok=function(c,d){a.formSubmitted=!0,c.$valid&&b.close(d)},a.cancel=function(){b.dismiss("cancel")},a.openDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0}}]),angular.module("rippleDemonstrator").controller("AllergiesListCtrl",["$scope","$location","$stateParams","SearchInput","$modal","$state","usSpinnerService","PatientService","Allergy",function(a,b,c,d,e,f,g,h,i){a.currentPage=1,d.update(),a.pageChangeHandler=function(b){a.currentPage=b},c.page&&(a.currentPage=c.page),a.search=function(b){return-1!==angular.lowercase(b.cause).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.reaction).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.source).indexOf(angular.lowercase(a.query)||"")},c.filter&&(a.query=c.filter),h.get(c.patientId).then(function(b){a.patient=b}),i.all(c.patientId).then(function(b){a.allergies=b.data,g.stop("patientSummary-spinner")}),a.go=function(b){f.go("allergies-detail",{patientId:a.patient.id,allergyIndex:b,filter:a.query,page:a.currentPage,reportType:c.reportType,searchString:c.searchString,queryType:c.queryType})},a.selected=function(a){return a===c.allergyIndex},a.create=function(){var b=e.open({templateUrl:"views/allergies/allergies-modal.html",size:"lg",controller:"AllergiesModalCtrl",resolve:{modal:function(){return{title:"Create Allergy"}},allergy:function(){return{}},patient:function(){return a.patient}}});b.result.then(function(b){var d={sourceId:"",cause:b.cause,causeCode:b.causeCode,causeTerminology:b.causeTerminology,reaction:b.reaction,source:"openehr"};i.create(a.patient.id,d).then(function(){setTimeout(function(){f.go("allergies",{patientId:a.patient.id,filter:a.query,page:a.currentPage,reportType:c.reportType,searchString:c.searchString,queryType:c.queryType},{reload:!0})},2e3)})})}}]),angular.module("rippleDemonstrator").controller("AllergiesDetailCtrl",["$scope","$stateParams","SearchInput","$modal","$state","$location","Helper","usSpinnerService","PatientService","Allergy",function(a,b,c,d,e,f,g,h,i,j){c.update(),i.get(b.patientId).then(function(b){a.patient=b}),j.get(b.patientId,b.allergyIndex).then(function(b){a.allergy=b.data,h.stop("allergiesDetail-spinner")}),a.edit=function(){var c=d.open({templateUrl:"views/allergies/allergies-modal.html",size:"lg",controller:"AllergiesModalCtrl",resolve:{modal:function(){return{title:"Edit Allergy"}},allergy:function(){return angular.copy(a.allergy)},patient:function(){return a.patient}}});c.result.then(function(c){var d={sourceId:c.sourceId,cause:c.cause,causeCode:c.causeCode,causeTerminology:c.causeTerminology,reaction:c.reaction,source:"openehr"};j.update(a.patient.id,d).then(function(){setTimeout(function(){e.go("allergies-detail",{patientId:a.patient.id,allergyIndex:g.updateId(c.sourceId),page:a.currentPage,reportType:b.reportType,searchString:b.searchString,queryType:b.queryType})},2e3)})})}}]),angular.module("rippleDemonstrator").controller("AllergiesModalCtrl",["$scope","$modalInstance","allergy","UserService","patient","modal",function(a,b,c,d,e,f){d.findCurrentUser().then(function(b){a.currentUser=b.data}),a.allergy=c,a.patient=e,a.modal=f,"Create Allergy"===f.title?(a.allergy.dateCreated=(new Date).toISOString().slice(0,10),a.allergy.causeCode="1239085",a.allergy.terminologyCode="12393890"):a.allergy.dateCreated=new Date(a.allergy.dateCreated).toISOString().slice(0,10),a.ok=function(c,d){a.formSubmitted=!0,c.$valid&&b.close(d)},a.cancel=function(){b.dismiss("cancel")},a.openDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0}}]),angular.module("rippleDemonstrator").controller("MedicationsListCtrl",["$scope","$state","$stateParams","SearchInput","$location","$modal","usSpinnerService","PatientService","MedicationService","UserService",function(a,b,c,d,e,f,g,h,i,j){d.update(),a.currentPage=1,j.findCurrentUser().then(function(b){a.currentUser=b.data,c.patientSource=a.currentUser.feature.patientSource}),a.pageChangeHandler=function(b){a.currentPage=b},c.page&&(a.currentPage=c.page),a.search=function(b){return-1!==angular.lowercase(b.name).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.doseamount).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.source).indexOf(angular.lowercase(a.query)||"")},c.filter&&(a.query=c.filter),h.get(c.patientId,c.patientSource).then(function(b){a.patient=b}),i.all(c.patientId).then(function(b){a.medications=b.data,g.stop("patientSummary-spinner")}),a.go=function(d,e){b.go("medications-detail",{patientId:a.patient.nhsNumber,medicationIndex:d,filter:a.query,page:a.currentPage,reportType:c.reportType,searchString:c.searchString,queryType:c.queryType,source:e,patientSource:c.patientSource})},a.selected=function(a){return a===c.medicationIndex}}]),angular.module("rippleDemonstrator").controller("MedicationsDetailCtrl",["$scope","$stateParams","SearchInput","$location","$modal","Helper","$state","usSpinnerService","PatientService","MedicationService",function(a,b,c,d,e,f,g,h,i,j){c.update(),a.UnlockedSources=["handi.ehrscape.com"],i.get(b.patientId).then(function(b){a.patient=b}),j.get(b.patientId,b.medicationIndex,b.source).then(function(b){a.medication=b.data,h.stop("medicationsDetail-spinner")}),a.isLocked=function(b){if(!b||!b.id)return!0;var c=b.id.toString().split("::");return c.length>1?a.UnlockedSources.indexOf(c[1])<0:!0},a.convertToLabel=function(a){var b=a.replace(/([A-Z])/g," $1");return b.charAt(0).toUpperCase()+b.slice(1)}}]),angular.module("rippleDemonstrator").controller("MedicationsModalCtrl",["$scope","$modalInstance","UserService","medication","patient","modal",function(a,b,c,d,e,f){c.findCurrentUser().then(function(b){a.currentUser=b.data}),a.medication=d,a.patient=e,a.modal=f,a.routes=["Po Per Oral","IV Intra Venous","PN Per Nasal","PR Per Rectum","SL Sub Lingual","SC Sub Cutaneous","IM Intra Muscular"],"Edit Medication"===f.title?(a.medication.startTime=new Date(a.medication.startTime),a.medication.startDate=new Date(a.medication.startDate).toISOString().slice(0,10),a.medication.dateCreated=new Date(a.medication.dateCreated).toISOString().slice(0,10)):(a.medication.terminologyCode="12393890",a.medication.dateCreated=(new Date).toISOString().slice(0,10)),a.ok=function(c,d){a.formSubmitted=!0,c.$valid&&b.close(d)},a.cancel=function(){b.dismiss("cancel")},a.openDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0}}]),angular.module("rippleDemonstrator").controller("ContactsListCtrl",["$scope","$state","$stateParams","SearchInput","$location","$modal","usSpinnerService","PatientService","ContactsService","UserService",function(a,b,c,d,e,f,g,h,i,j){d.update(),a.currentPage=1,j.findCurrentUser().then(function(b){a.currentUser=b.data,c.patientSource=a.currentUser.feature.patientSource}),a.pageChangeHandler=function(b){a.currentPage=b},c.page&&(a.currentPage=c.page),a.search=function(b){return-1!==angular.lowercase(b.name).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.relationship).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.nextOfKin).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.source).indexOf(angular.lowercase(a.query)||"")},c.filter&&(a.query=c.filter),h.get(c.patientId,c.patientSource).then(function(b){a.patient=b}),i.all(c.patientId).then(function(b){a.contacts=b.data,g.stop("patientSummary-spinner")}),a.go=function(d,e){b.go("contacts-detail",{patientId:a.patient.nhsNumber,contactIndex:d,filter:a.query,page:a.currentPage,reportType:c.reportType,searchString:c.searchString,queryType:c.queryType,source:e,patientSource:c.patientSource})},a.selected=function(a){return a===c.contactIndex}}]),angular.module("rippleDemonstrator").controller("ContactsDetailCtrl",["$scope","$stateParams","SearchInput","$location","$modal","Helper","$state","usSpinnerService","PatientService","ContactsService",function(a,b,c,d,e,f,g,h,i,j){c.update(),a.UnlockedSources=["handi.ehrscape.com"],i.get(b.patientId).then(function(b){a.patient=b}),j.get(b.patientId,b.contactIndex,b.source).then(function(b){a.contact=b.data,h.stop("contactDetail-spinner")}),a.isLocked=function(b){if(!b||!b.id)return!0;var c=b.id.toString().split("::");return c.length>1?a.UnlockedSources.indexOf(c[1])<0:!0},a.convertToLabel=function(a){var b=a.replace(/([A-Z])/g," $1");return b.charAt(0).toUpperCase()+b.slice(1)}}]),angular.module("rippleDemonstrator").controller("ContactsModalCtrl",["$scope","$modalInstance","contact","UserService","patient","modal",function(a,b,c,d,e,f){d.findCurrentUser().then(function(b){a.currentUser=b.data}),a.contact=c,a.patient=e,a.modal=f,"Create Contact"===f.title?(a.contact.dateSubmitted=(new Date).toISOString().slice(0,10),a.contact.relationshipCode="at0039",a.contact.relationshipTerminology="local"):a.contact.dateSubmitted=(new Date).toISOString().slice(0,10),a.ok=function(c,d){a.formSubmitted=!0,c.$valid&&b.close(d)},a.cancel=function(){b.dismiss("cancel")},a.openDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0}}]),angular.module("rippleDemonstrator").controller("TransferOfCareCtrl",["$modal","$state","$scope","$q","$stateParams","PatientService","TransferOfCare","Allergy","Diagnosis","Medication","Contact",function(a,b,c,d,e,f,g,h,i,j,k){function l(){a.open({templateUrl:"views/transfer-of-care/transfer-of-care-confirmation.html",size:"md",controller:["$scope",function(a){a.ok=function(){a.$close()}}]}).result["finally"](function(){setTimeout(function(){b.go("transferOfCare",{patientId:c.patient.id,reportType:e.reportType,searchString:e.searchString,queryType:e.queryType})},2e3)})}a.open({templateUrl:"views/transfer-of-care/transfer-of-care-modal.html",size:"lg",resolve:{patient:function(){return f.get(e.patientId).then(function(a){return c.patient=a,c.patient})},transferOfCareCompositions:function(){return g.all(e.patientId).then(function(a){return c.transferOfCareCompositions=a.data,c.transferOfCareCompositions})}},controller:["$scope","patient","transferOfCareCompositions",function(a,c,f){function l(){var b=jQuery.extend(!0,{},a.transferOfCare.allergies,a.transferOfCare.contacts,a.transferOfCare.medication,a.transferOfCare.problems);delete b.compositionId;for(var c in a.selectedItems)switch(c){case"allergies":break;case"contacts":break;case"medications":break;case"problems":for(var d=b[c].length;d--;){var e=!1;angular.forEach(a.selectedItems[c],function(a){d===a&&(e=!0)}),e===!1&&b[c].splice(d,1)}}return b}a.transferOfCare={},d.all([h.all(e.patientId),i.all(e.patientId),j.all(e.patientId),k.all(e.patientId)]).then(function(b){a.transferOfCare.allergies={},a.transferOfCare.problems={},a.transferOfCare.medication={},a.transferOfCare.contacts={},a.transferOfCare.allergies.allergies=b[0].data,a.transferOfCare.problems.problems=b[1].data,a.transferOfCare.medication.medications=b[2].data,a.transferOfCare.contacts.contacts=b[3].data,a.allergies=a.transferOfCare.allergies.allergies,a.problems=a.transferOfCare.problems.problems,a.medications=a.transferOfCare.medication.medications,a.contacts=a.transferOfCare.contacts.contacts}),a.patient=c,a.transferOfCareComposition=f,a.siteFrom="WORCESTERSHIRE HEALTH AND CARE NHS TRUST",a.selectedItems={allergies:[],contacts:[],medications:[],problems:[]},a.transferDetail={site:{}},a.selectTransferOfCareItem=function(b,c){-1!==a.selectedItems[c].indexOf(b)?a.selectedItems[c].splice(a.selectedItems[c].indexOf(b),1):a.selectedItems[c].push(b)},a.isItemSelected=function(b,c){return-1!==a.selectedItems[c].indexOf(b)?"transfer-of-care-green":"transfer-of-care-red"},a.isItemSelectedIcon=function(b,c){return-1!==a.selectedItems[c].indexOf(b)?"glyphicon glyphicon-ok":"glyphicon glyphicon-remove"},a.getSelectedItItemsForSummary=function(b){a.formSubmitted=!0,b.$valid&&(a.selectedItemsForSummary=l(),a.selectedAllergies=a.selectedItemsForSummary.allergies,a.selectedContacts=a.selectedItemsForSummary.contacts,a.selectedProblems=a.selectedItemsForSummary.problems,a.selectedMedications=a.selectedItemsForSummary.medications,a.transferDetail.reasonForContact=a.details.reasonForContact?a.details.reasonForContact:"No reason specified",a.transferDetail.clinicalSummary=a.details.clinicalSummary?a.details.clinicalSummary:"No clinical summary",a.transferDetail.site.siteFrom=a.siteFrom?a.siteFrom:"No site from",a.transferDetail.site.siteTo=a.details.siteTo?a.details.siteTo:"No site to",a.transferDetail.site.patientId=a.patientId,a.toggleDetailView())},a.displayDetail=!1,a.toggleDetailView=function(){a.displayDetail=!a.displayDetail},a.dismiss=function(){a.$dismiss(),b.go("transferOfCare",{patientId:a.patient.id})},a.ok=function(){a.transferOfCare=l(),a.transferOfCare.medication=a.transferOfCare.medications,delete a.transferOfCare.medications,a.transferOfCare.transferDetail=a.transferDetail,angular.forEach(a.transferOfCare.allergies,function(b,c){a.transferOfCare.allergies[c]={allergy:b.cause,source:b.source,sourceId:b.sourceId}}),angular.forEach(a.transferOfCare.contacts,function(b,c){a.transferOfCare.contacts[c]={contactName:b.name,source:b.source,sourceId:b.sourceId}}),angular.forEach(a.transferOfCare.medication,function(b,c){a.transferOfCare.medication[c]={medication:b.name,source:b.source,sourceId:b.sourceId}});var b=new Date,c={allergies:a.transferOfCare.allergies,contacts:a.transferOfCare.contacts,medications:a.transferOfCare.medication,problems:a.transferOfCare.problems,clinicalSummary:a.transferDetail.clinicalSummary,dateOfTransfer:b,reasonForContact:a.transferDetail.reasonForContact,siteFrom:"WORCESTERSHIRE HEALTH AND CARE NHS TRUST",siteTo:a.details.siteTo,source:"openehr",sourceId:""};g.create(a.patient.id,c).then(function(){a.$close()}),a.$close()}}]}).result.then(function(){l()})}]),angular.module("rippleDemonstrator").controller("TransferOfCareListCtrl",["$scope","$state","$stateParams","SearchInput","$location","$modal","usSpinnerService","PatientService","TransferOfCareService","UserService",function(a,b,c,d,e,f,g,h,i,j){d.update(),a.currentPage=1,j.findCurrentUser().then(function(b){a.currentUser=b.data,
c.patientSource=a.currentUser.feature.patientSource}),a.pageChangeHandler=function(b){a.currentPage=b},c.page&&(a.currentPage=c.page),a.search=function(b){return-1!==angular.lowercase(b.siteFrom).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.siteTo).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.dateOfTransfer).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.source).indexOf(angular.lowercase(a.query)||"")},c.filter&&(a.query=c.filter),h.get(c.patientId,c.patientSource).then(function(b){a.patient=b}),i.all(c.patientId).then(function(b){a.transfers=b.data,g.stop("patientSummary-spinner")}),a.go=function(d,e){b.go("transferOfCare-detail",{patientId:a.patient.nhsNumber,transferIndex:d,filter:a.query,page:a.currentPage,reportType:c.reportType,searchString:c.searchString,queryType:c.queryType,source:e,patientSource:c.patientSource})},a.selected=function(a){return a===c.transferIndex},a.careOrder=function(a){return a.careType.indexOf("Admission")>-1?0:a.careType.indexOf("Transfer")>-1?1:a.careType.indexOf("Discharge")>-1?2:void 0}}]),angular.module("rippleDemonstrator").controller("TransferOfCareDetailCtrl",["$scope","$stateParams","SearchInput","$location","$modal","Helper","$state","usSpinnerService","PatientService","TransferOfCareService",function(a,b,c,d,e,f,g,h,i,j){c.update(),a.UnlockedSources=["handi.ehrscape.com"],i.get(b.patientId).then(function(b){a.patient=b}),j.get(b.patientId,b.transferIndex,b.source).then(function(b){a.transfer=b.data,h.stop("transferDetail-spinner")}),a.isLocked=function(b){if(!b||!b.id)return!0;var c=b.id.toString().split("::");return c.length>1?a.UnlockedSources.indexOf(c[1])<0:!0},a.convertToLabel=function(a){var b=a.replace(/([A-Z])/g," $1");return b.charAt(0).toUpperCase()+b.slice(1)}}]),angular.module("rippleDemonstrator").controller("CancerMdtModalCtrl",["$scope","$modalInstance","$stateParams","$state","cancerMdt","patient","modal",function(a,b,c,d,e,f,g){a.cancerMdt=e,a.protocol="http://","Edit MDT"===g.title&&(a.cancerMdt.timeOfMeeting=new Date(a.cancerMdt.timeOfMeeting),a.cancerMdt.dateOfMeeting=new Date(a.cancerMdt.dateOfMeeting).toISOString().slice(0,10),a.cancerMdt.dateOfRequest=new Date(a.cancerMdt.dateOfRequest).toISOString().slice(0,10)),a.changeProtocol=function(b){switch(b){case"http":a.protocol="http://";break;case"https":a.protocol="https://";break;default:a.protocol="http://"}},a.patient=f,a.modal=g,a.ok=function(c,d){a.formSubmitted=!0,c.$valid&&b.close(d)},a.cancel=function(){b.dismiss("cancel")},a.openDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.dateofMeetingDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.validate=function(a,b,c){var d=b+c;for(var e in a.$error.required){var f=a.$error.required[e].$name;if(f===d)return!0}},a.validateDirty=function(a,b,c){var d=b+c;return a[d].$dirty&&a[d].$invalid},a.validateClean=function(a,b,c){var d=b+c;return a[d].$dirty&&a[d].$valid}}]),angular.module("rippleDemonstrator").controller("CancerMdtListCtrl",["$scope","$location","$stateParams","SearchInput","$modal","$state","usSpinnerService","PatientService","CancerMdt",function(a,b,c,d,e,f,g,h,i){a.currentPage=1,d.update(),a.pageChangeHandler=function(b){a.currentPage=b},c.page&&(a.currentPage=c.page),a.search=function(b){return-1!==angular.lowercase(b.dateOfRequest).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.serviceTeam).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.dateOfMeeting).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.source).indexOf(angular.lowercase(a.query)||"")},c.filter&&(a.query=c.filter),h.get(c.patientId).then(function(b){a.patient=b}),i.all(c.patientId).then(function(b){a.cancerMdtComposition=b.data;for(var c=0;c<a.cancerMdtComposition.length;c++)a.cancerMdtComposition[c].dateOfRequest=moment(a.cancerMdtComposition[c].dateOfRequest).format("DD-MMM-YYYY"),a.cancerMdtComposition[c].dateOfMeeting=moment(a.cancerMdtComposition[c].dateOfMeeting).format("DD-MMM-YYYY");g.stop("patientSummary-spinner")}),a.go=function(b){f.go("cancerMdt-detail",{patientId:a.patient.id,cancerMdtIndex:b,filter:a.query,page:a.currentPage,reportType:c.reportType,searchString:c.searchString,queryType:c.queryType})},a.selected=function(a){return a===c.cancerMdtIndex},a.create=function(){var b=e.open({templateUrl:"views/cancer-mdt/cancer-mdt-modal.html",size:"lg",controller:"CancerMdtModalCtrl",resolve:{modal:function(){return{title:"Create MDT"}},cancerMdt:function(){return{}},patient:function(){return a.patient}}});b.result.then(function(b){b.dateOfMeeting=new Date(b.dateOfMeeting),b.dateOfMeeting.setMinutes(b.dateOfMeeting.getMinutes()-b.dateOfMeeting.getTimezoneOffset()),b.dateOfRequest=new Date(b.dateOfRequest),b.dateOfRequest.setMinutes(b.dateOfRequest.getMinutes()-b.dateOfRequest.getTimezoneOffset()),null!==b.timeOfMeeting&&(b.timeOfMeeting=new Date(b.timeOfMeeting),b.timeOfMeeting.setMinutes(b.timeOfMeeting.getMinutes()-b.timeOfMeeting.getTimezoneOffset())),b.compositionId="",b.source="openehr",i.create(a.patient.id,b).then(function(){setTimeout(function(){f.go("cancerMdt",{patientId:a.patient.id,filter:a.query,page:a.currentPage,reportType:c.reportType,searchString:c.searchString,queryType:c.queryType},{reload:!0})},2e3)})})}}]),angular.module("rippleDemonstrator").controller("CancerMdtDetailCtrl",["$scope","$stateParams","SearchInput","$modal","$location","Helper","$state","usSpinnerService","PatientService","CancerMdt",function(a,b,c,d,e,f,g,h,i,j){c.update(),i.get(b.patientId).then(function(b){a.patient=b}),j.get(b.patientId,b.cancerMdtIndex).then(function(b){a.cancerMdt=b.data,h.stop("mdtDetail-spinner")}),a.edit=function(){var c=d.open({templateUrl:"views/cancer-mdt/cancer-mdt-modal.html",size:"lg",controller:"CancerMdtModalCtrl",resolve:{modal:function(){return{title:"Edit MDT"}},cancerMdt:function(){return angular.copy(a.cancerMdt)},patient:function(){return a.patient}}});c.result.then(function(c){c.dateOfMeeting=new Date(c.dateOfMeeting),c.dateOfRequest=new Date(c.dateOfRequest),null!==c.timeOfMeeting&&(c.timeOfMeeting=new Date(c.timeOfMeeting)),j.update(a.patient.id,c).then(function(){setTimeout(function(){g.go("cancerMdt-detail",{patientId:a.patient.id,cancerMdtIndex:f.updateId(c.sourceId),page:a.currentPage,reportType:b.reportType,searchString:b.searchString,queryType:b.queryType})},2e3)})})}}]),angular.module("rippleDemonstrator").controller("AppointmentsModalCtrl",["$scope","$modalInstance","$modal","UserService","appointment","patient","modal",function(a,b,c,d,e,f,g){function h(b){var d=c.open({templateUrl:"views/appointments/appointments-confirm-modal.html",size:"sm   ",windowClass:"confirm-modal",controller:"AppointmentsConfirmModalCtrl",resolve:{modal:function(){return{title:"Confirm Date"}},time:function(){return angular.copy(b)}}});d.result.then(function(){a.appointment.timeOfAppointment=b,a.appointment.status="Scheduled",a.appointment.dateOfAppointment=b.toISOString().slice(0,10),a.timeSlotFull=moment(a.appointment.timeOfAppointment).format("h:mma")+"-"+moment(a.appointment.timeOfAppointment).add(59,"m").format("h:mma"),i(),a.radioModel="Tab1"})}function i(){for(var b=a.appointment.dateOfAppointment.slice(0,10)+" "+a.appointment.timeOfAppointment.toISOString().slice(11,13)+":00",c=0;c<a.uiConfig.calendar.events.length;c++){var d=a.uiConfig.calendar.events[c];"#6599C8"===d.color&&(d.color="#378006"),d.start===b&&(d.color="#6599C8")}}d.findCurrentUser().then(function(b){a.currentUser=b.data,$stateParams.patientSource=a.currentUser.feature.patientSource}),a.appointment=e,a.patient=f,a.modal=g,a.radioModel="Tab1",a.appointment.location=e.location||"Leeds General",a.appointment.status=e.status||"Not Scheduled","Edit Appointment"===g.title?(a.appointment.dateCreated=new Date(a.appointment.dateCreated).toISOString(),a.appointment.dateOfAppointment=new Date(a.appointment.dateOfAppointment).toISOString(),a.appointment.timeOfAppointment=new Date(a.appointment.timeOfAppointment)):a.appointment.dateCreated=(new Date).toISOString().slice(0,10),"Scheduled"===a.appointment.status&&(a.timeSlotFull=moment(e.timeOfAppointment).format("h:mma")+"-"+moment(e.timeOfAppointment).add(59,"m").format("h:mma")),a.uiConfig={calendar:{height:450,width:400,editable:!0,aspectRatio:1.7,defaultDate:"2015-02-12",Duration:"01:00:00",lang:"en-gb",eventColor:"#378006",events:[{title:"Time Slot 1",start:"2015-02-09 09:00",end:"2015-02-09 09:59"},{title:"Time Slot 2",start:"2015-02-09 10:00",end:"2015-02-09 10:59"},{title:"Time Slot 3",start:"2015-02-09 11:00",end:"2015-02-09 11:59"},{title:"Time Slot 4",start:"2015-02-09 12:00",end:"2015-02-09 12:59"},{title:"Time Slot 5",start:"2015-02-09 13:00",end:"2015-02-09 13:59"},{title:"Time Slot 6",start:"2015-02-09 14:00",end:"2015-02-09 14:59"},{title:"Time Slot 7",start:"2015-02-09 15:00",end:"2015-02-09 15:59"},{title:"Time Slot 8",start:"2015-02-09 16:00",end:"2015-02-09 16:59"},{title:"Time Slot 1",start:"2015-02-10 09:00",end:"2015-02-10 09:59"},{title:"Time Slot 2",start:"2015-02-10 10:00",end:"2015-02-10 10:59"},{title:"Time Slot 3",start:"2015-02-10 11:00",end:"2015-02-10 11:59"},{title:"Time Slot 4",start:"2015-02-10 12:00",end:"2015-02-10 12:59"},{title:"Time Slot 5",start:"2015-02-10 13:00",end:"2015-02-10 13:59"},{title:"Time Slot 6",start:"2015-02-10 14:00",end:"2015-02-10 14:59"},{title:"Time Slot 7",start:"2015-02-10 15:00",end:"2015-02-10 15:59"},{title:"Time Slot 8",start:"2015-02-10 16:00",end:"2015-02-10 16:59"},{title:"Time Slot 1",start:"2015-02-11 09:00",end:"2015-02-11 09:59"},{title:"Time Slot 2",start:"2015-02-11 10:00",end:"2015-02-11 10:59"},{title:"Time Slot 3",start:"2015-02-11 11:00",end:"2015-02-11 11:59"},{title:"Time Slot 4",start:"2015-02-11 12:00",end:"2015-02-11 12:59"},{title:"Time Slot 5",start:"2015-02-11 13:00",end:"2015-02-11 13:59"},{title:"Time Slot 6",start:"2015-02-11 14:00",end:"2015-02-11 14:59"},{title:"Time Slot 7",start:"2015-02-11 15:00",end:"2015-02-11 15:59"},{title:"Time Slot 8",start:"2015-02-11 16:00",end:"2015-02-11 16:59"},{title:"Time Slot 1",start:"2015-02-12 09:00",end:"2015-02-12 09:59"},{title:"Time Slot 2",start:"2015-02-12 10:00",end:"2015-02-12 10:59"},{title:"Time Slot 3",start:"2015-02-12 11:00",end:"2015-02-12 11:59"},{title:"Time Slot 4",start:"2015-02-12 12:00",end:"2015-02-12 12:59"},{title:"Time Slot 5",start:"2015-02-12 13:00",end:"2015-02-12 13:59"},{title:"Time Slot 6",start:"2015-02-12 14:00",end:"2015-02-12 14:59"},{title:"Time Slot 7",start:"2015-02-12 15:00",end:"2015-02-12 15:59"},{title:"Time Slot 8",start:"2015-02-12 16:00",end:"2015-02-12 16:59"},{title:"Time Slot 1",start:"2015-02-13 09:00",end:"2015-02-13 09:59"},{title:"Time Slot 2",start:"2015-02-13 10:00",end:"2015-02-13 10:59"},{title:"Time Slot 3",start:"2015-02-13 11:00",end:"2015-02-13 11:59"},{title:"Time Slot 4",start:"2015-02-13 12:00",end:"2015-02-13 12:59"},{title:"Time Slot 5",start:"2015-02-13 13:00",end:"2015-02-13 13:59",color:"#dd2b08"},{title:"Time Slot 6",start:"2015-02-13 14:00",end:"2015-02-13 14:59"},{title:"Time Slot 7",start:"2015-02-13 15:00",end:"2015-02-13 15:59"},{title:"Time Slot 8",start:"2015-02-13 16:00",end:"2015-02-13 16:59"}],header:{right:"month,agendaWeek,agendaDay",center:"title",left:"prev,next"},columnFormat:{week:"ddd D/M"},eventClick:function(b){a.setTimeSlot(b.start)},eventMouseover:function(a){"#dd2b08"===a.color&&$(this).css("cursor","not-allowed")},eventDrop:a.alertOnDrop,eventResize:a.alertOnResize,defaultView:"agendaWeek",allDaySlot:!1,minTime:"9:00",maxTime:"17:00",weekends:!1}},a.eventSources=[],"Create Appointment"===g.title?a.appointment.dateCreated=(new Date).toISOString().slice(0,10):(a.appointment.timeOfAppointment=new Date(a.appointment.timeOfAppointment),i());var j=function(){return a.appointment.dateOfAppointment&&a.appointment.timeOfAppointment};a.getScheduleLabel=function(){return j()?" Re-Schedule":" Schedule"},a.openAppointmentDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.openDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.setTimeSlot=function(b){for(var c=0;c<a.uiConfig.calendar.events.length;c++){var d=a.uiConfig.calendar.events[c];d.start===b._i&&"#dd2b08"!==d.color&&h(b)}},a.schedule=function(){a.radioModel="Tab2"},a.ok=function(c,d){a.formSubmitted=!0,c.$valid&&b.close(d)},a.cancel=function(){b.dismiss("cancel")},a.openDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0}}]),angular.module("rippleDemonstrator").controller("AppointmentsConfirmModalCtrl",["$scope","$modalInstance","time",function(a,b,c){a.modal=b,a.time=new Date(c),a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("rippleDemonstrator").controller("AppointmentListCtrl",["$scope","$filter","$state","$stateParams","SearchInput","$location","$modal","usSpinnerService","PatientService","AppointmentService","UserService",function(a,b,c,d,e,f,g,h,i,j,k){e.update(),a.currentPage=1,k.findCurrentUser().then(function(b){a.currentUser=b.data,d.patientSource=a.currentUser.feature.patientSource}),a.pageChangeHandler=function(b){a.currentPage=b},d.page&&(a.currentPage=d.page),a.search=function(c){var d=b("date")(c.dateOfAppointment,"dd/MM/yyyy"),e=b("date")(c.timeOfAppointment,"HH:mm");return-1!==angular.lowercase(c.serviceTeam).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(c.source).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(d).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(e).indexOf(angular.lowercase(a.query)||"")},d.filter&&(a.query=d.filter),i.get(d.patientId,d.patientSource).then(function(b){a.patient=b}),j.all(d.patientId).then(function(b){a.appointments=b.data,h.stop("patientSummary-spinner")}),a.go=function(b,e){c.go("appointments-detail",{patientId:a.patient.nhsNumber,appointmentIndex:b,filter:a.query,page:a.currentPage,reportType:d.reportType,searchString:d.searchString,queryType:d.queryType,source:e,patientSource:d.patientSource})},a.selected=function(a){return a===d.appointmentIndex}}]),angular.module("rippleDemonstrator").controller("AppointmentDetailCtrl",["$scope","$stateParams","SearchInput","$location","$modal","Helper","$state","usSpinnerService","PatientService","AppointmentService",function(a,b,c,d,e,f,g,h,i,j){c.update(),a.UnlockedSources=["handi.ehrscape.com"],i.get(b.patientId).then(function(b){a.patient=b}),j.get(b.patientId,b.appointmentIndex,b.source).then(function(b){a.appointment=b.data,h.stop("appointmentDetail-spinner")}),a.isLocked=function(b){if(!b||!b.id)return!0;var c=b.id.toString().split("::");return c.length>1?a.UnlockedSources.indexOf(c[1])<0:!0},a.convertToLabel=function(a){var b=a.replace(/([A-Z])/g," $1");return b.charAt(0).toUpperCase()+b.slice(1)}}]),angular.module("rippleDemonstrator").controller("ReferralsModalCtrl",["$scope","$modalInstance","UserService","referral","patient","modal",function(a,b,c,d,e,f){$("#dateofreferral").datepicker({dateFormat:"dd-MMM-y"}),c.findCurrentUser().then(function(b){a.currentUser=b.data}),a.referral=d,a.patient=e,a.modal=f,"Create Referral"===f.title?(a.referral.dateCreated=(new Date).toISOString().slice(0,10),a.author=a.currentUser):(a.referral.dateCreated=new Date(a.referral.dateCreated).toISOString().slice(0,10),a.referral.dateOfReferral=new Date(a.referral.dateOfReferral).toISOString().slice(0,10)),a.referralCreatedDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.dateofReferralDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.ok=function(c,d){a.formSubmitted=!0,c.$valid&&b.close(d)},a.cancel=function(){b.dismiss("cancel")},a.openDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.validate=function(a,b,c){var d=b+c;for(var e in a.$error.required){var f=a.$error.required[e].$name;if(f===d)return!0}},a.validateDirty=function(a,b,c){var d=b+c;return a[d].$dirty&&a[d].$invalid},a.validateClean=function(a,b,c){var d=b+c;return a[d].$dirty&&a[d].$valid}}]),angular.module("rippleDemonstrator").controller("ReferralListCtrl",["$scope","$filter","$state","$stateParams","SearchInput","$location","$modal","usSpinnerService","PatientService","ReferralService","UserService",function(a,b,c,d,e,f,g,h,i,j,k){e.update(),a.currentPage=1,k.findCurrentUser().then(function(b){a.currentUser=b.data,d.patientSource=a.currentUser.feature.patientSource}),a.pageChangeHandler=function(b){a.currentPage=b},d.page&&(a.currentPage=d.page),a.search=function(c){var d=b("date")(c.dateOfReferral,"dd/MM/yyyy");return-1!==angular.lowercase(c.referralFrom).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(c.referralTo).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(d).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(c.source).indexOf(angular.lowercase(a.query)||"")},d.filter&&(a.query=d.filter),i.get(d.patientId,d.patientSource).then(function(b){a.patient=b}),j.all(d.patientId).then(function(b){a.referrals=b.data,h.stop("patientSummary-spinner")}),a.go=function(b,e){c.go("referrals-detail",{patientId:a.patient.nhsNumber,referralIndex:b,filter:a.query,page:a.currentPage,reportType:d.reportType,searchString:d.searchString,queryType:d.queryType,source:e,patientSource:d.patientSource})},a.selected=function(a){return a===d.referralIndex}}]),angular.module("rippleDemonstrator").controller("ReferralDetailCtrl",["$scope","$stateParams","SearchInput","$location","$modal","Helper","$state","usSpinnerService","PatientService","ReferralService",function(a,b,c,d,e,f,g,h,i,j){c.update(),a.UnlockedSources=["handi.ehrscape.com"],i.get(b.patientId).then(function(b){a.patient=b}),j.get(b.patientId,b.referralIndex,b.source).then(function(b){a.referral=b.data,h.stop("referralsDetail-spinner")}),a.isLocked=function(b){if(!b||!b.id)return!0;var c=b.id.toString().split("::");return c.length>1?a.UnlockedSources.indexOf(c[1])<0:!0},a.convertToLabel=function(a){var b=a.replace(/([A-Z])/g," $1");return b.charAt(0).toUpperCase()+b.slice(1)}}]),angular.module("rippleDemonstrator").controller("EolcareplansModalCtrl",["$scope","$filter","$modalInstance","UserService","eolcareplan","patient","modal",function(a,b,c,d,e,f,g){d.findCurrentUser().then(function(b){a.currentUser=b.data}),a.eolcareplan=e,a.patient=f,a.modal=g,a.docTypes=[{type:"Document Type"},{type:"Document Type 2"}],"Create End of Life Care Document"===g.title?a.eolcareplan.careDocument={dateCreated:(new Date).toISOString().slice(0,10)}:(a.eolcareplan.careDocument.dateCreated=new Date(a.eolcareplan.careDocument.dateCreated).toISOString().slice(0,10),a.eolcareplan.cprDecision.dateOfDecision=new Date(a.eolcareplan.cprDecision.dateOfDecision).toISOString().slice(0,10),a.eolcareplan.treatmentDecision.dateOfDecision=new Date(a.eolcareplan.treatmentDecision.dateOfDecision).toISOString().slice(0,10)),a.ok=function(b,d){a.formSubmitted=!0,b.$valid&&c.close(d)},a.cancel=function(){c.dismiss("cancel")},a.radioModel="Tab1",a.typesAvaliable=["Document","Document T1","Document T2","Document T3"],a.typesChosen=a.typesAvaliable[0],a.openDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.openDecisionDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.dateofcprdecisionDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.validate=function(a,b,c){var d=b+c;for(var e in a.$error.required){var f=a.$error.required[e].$name;if(f===d)return!0}},a.validateDirty=function(a,b,c){var d=b+c;return a[d].$dirty&&a[d].$invalid},a.validateClean=function(a,b,c){var d=b+c;return a[d].$dirty&&a[d].$valid}}]),angular.module("rippleDemonstrator").controller("EolcareplansListCtrl",["$scope","$location","$stateParams","SearchInput","$modal","usSpinnerService","$state","PatientService","Eolcareplan",function(a,b,c,d,e,f,g,h,i){a.currentPage=1,d.update(),a.pageChangeHandler=function(b){a.currentPage=b},c.page&&(a.currentPage=c.page),c.filter&&(a.query=c.filter),a.search=function(b){return-1!==angular.lowercase(b.name).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.type).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.date).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.source).indexOf(angular.lowercase(a.query)||"")},h.get(c.patientId).then(function(b){a.patient=b}),i.all(c.patientId).then(function(b){if(a.eolcareplans=b.data,b.data.length>0)for(var c=0;c<a.eolcareplans.length;c++)a.eolcareplans[c].date=moment(a.eolcareplans[c].date).format("DD-MMM-YYYY");f.stop("patientSummary-spinner")}),a.go=function(b){g.go("eolcareplans-detail",{patientId:a.patient.id,eolcareplansIndex:b,filter:a.query,page:a.currentPage,reportType:c.reportType,searchString:c.searchString,queryType:c.queryType})},a.selected=function(a){return a===c.eolcareplansIndex},a.create=function(){var b=e.open({templateUrl:"views/care-plans/eolcareplans-modal.html",size:"lg",controller:"EolcareplansModalCtrl",resolve:{modal:function(){return{title:"Create End of Life Care Document"}},eolcareplan:function(){return{}},patient:function(){return a.patient}}});b.result.then(function(b){b.careDocument.type=b.careDocument.type.type,b.careDocument.dateCreated=new Date(b.careDocument.dateCreated),b.cprDecision.dateOfDecision=new Date(b.cprDecision.dateOfDecision),b.treatmentDecision.dateOfDecision=new Date(b.treatmentDecision.dateOfDecision);var d={sourceId:"",careDocument:b.careDocument,cprDecision:b.cprDecision,prioritiesOfCare:b.prioritiesOfCare,source:"openehr",treatmentDecision:b.treatmentDecision};i.create(a.patient.id,d).then(function(){setTimeout(function(){g.go("eolcareplans",{patientId:a.patient.id,filter:a.query,page:a.currentPage,reportType:c.reportType,searchString:c.searchString,queryType:c.queryType},{reload:!0})},2e3)})})}}]),angular.module("rippleDemonstrator").controller("EolcareplansDetailCtrl",["$scope","$stateParams","SearchInput","$modal","$location","$state","Helper","usSpinnerService","PatientService","Eolcareplan",function(a,b,c,d,e,f,g,h,i,j){c.update(),i.get(b.patientId).then(function(b){a.patient=b}),j.get(b.patientId,b.eolcareplansIndex).then(function(b){a.eolcareplan=b.data,h.stop("eolcareplansDetail-spinner")}),a.edit=function(){var c=d.open({templateUrl:"views/care-plans/eolcareplans-modal.html",size:"lg",controller:"EolcareplansModalCtrl",resolve:{modal:function(){return{title:"Edit End of Life Care Document"}},eolcareplan:function(){return angular.copy(a.eolcareplan)},patient:function(){return a.patient}}});c.result.then(function(c){c.careDocument.type=c.careDocument.type.type,c.careDocument.dateCreated=new Date(c.careDocument.dateCreated),c.cprDecision.dateOfDecision=new Date(c.cprDecision.dateOfDecision),c.treatmentDecision.dateOfDecision=new Date(c.treatmentDecision.dateOfDecision);var d={sourceId:c.sourceId,careDocument:c.careDocument,cprDecision:c.cprDecision,prioritiesOfCare:c.prioritiesOfCare,source:"openehr",treatmentDecision:c.treatmentDecision};j.update(a.patient.id,d).then(function(){setTimeout(function(){f.go("eolcareplans-detail",{patientId:a.patient.id,eolcareplansIndex:g.updateId(c.sourceId),page:a.currentPage,reportType:b.reportType,searchString:b.searchString,queryType:b.queryType})},2e3)})})}}]),angular.module("rippleDemonstrator").controller("ProceduresModalCtrl",["$scope","$filter","$modalInstance","UserService","patient","modal","procedure",function(a,b,c,d,e,f,g){d.findCurrentUser().then(function(b){a.currentUser=b.data,$stateParams.patientSource=a.currentUser.feature.patientSource}),a.procedure=g,a.patient=e,a.modal=f,"Create Procedure"===f.title?a.procedure.dateSubmitted=(new Date).toISOString().slice(0,10):(a.procedure.time=new Date(a.procedure.time),a.procedure.dateSubmitted=new Date(a.procedure.dateSubmitted).toISOString().slice(0,10),a.procedure.date=new Date(a.procedure.date).toISOString().slice(0,10)),a.procedure.currentStatusCode="1234567",a.procedure.currentStatusTerminology="ICD-10",a.dateofProcedureDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.dateofSubmittedDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.ok=function(b,d){a.formSubmitted=!0,b.$valid&&c.close(d)},a.cancel=function(){c.dismiss("cancel")},a.validate=function(a,b,c){var d=b+c;for(var e in a.$error.required){var f=a.$error.required[e].$name;if(f===d)return!0}},a.validateDirty=function(a,b,c){var d=b+c;return a[d].$dirty&&a[d].$invalid},a.validateClean=function(a,b,c){var d=b+c;return a[d].$dirty&&a[d].$valid}}]),angular.module("rippleDemonstrator").controller("ProceduresListCtrl",["$scope","$location","$stateParams","SearchInput","$modal","$state","usSpinnerService","PatientService","Procedure",function(a,b,c,d,e,f,g,h,i){a.currentPage=1,d.update(),a.pageChangeHandler=function(b){a.currentPage=b},c.page&&(a.currentPage=c.page),a.search=function(b){return-1!==angular.lowercase(b.name).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.date).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.time).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.source).indexOf(angular.lowercase(a.query)||"")},h.get(c.patientId).then(function(b){a.patient=b}),c.filter&&(a.query=c.filter),i.all(c.patientId).then(function(b){a.procedures=b.data;for(var c=0;c<a.procedures.length;c++)a.procedures[c].date=moment(a.procedures[c].date).format("DD-MMM-YYYY"),a.procedures[c].time=moment(a.procedures[c].time).format("HH:mm");g.stop("patientSummary-spinner")}),a.go=function(b,d){f.go("procedures-detail",{patientId:a.patient.id,procedureId:b,filter:a.query,page:a.currentPage,reportType:c.reportType,searchString:c.searchString,queryType:c.queryType,source:d})},a.selected=function(a){return a===c.procedureId},a.create=function(){var b=e.open({templateUrl:"views/procedures/procedures-modal.html",size:"lg",controller:"ProceduresModalCtrl",resolve:{modal:function(){return{title:"Create Procedure"}},procedure:function(){return{}},patient:function(){return a.patient}}});b.result.then(function(b){b.dateSubmitted=new Date(b.dateSubmitted),b.date=new Date(b.date),b.date.setMinutes(b.date.getMinutes()-b.date.getTimezoneOffset()),b.time=new Date(b.time.valueOf()-6e4*b.time.getTimezoneOffset());var d={sourceId:"",name:b.name,notes:b.notes,author:b.author,currentStatusTerminology:"local",currentStatusCode:"at0047",date:b.date,time:b.time,performer:b.performer,dateSubmitted:b.dateSubmitted,source:"openehr"};i.create(a.patient.id,d).then(function(){setTimeout(function(){f.go("procedures",{patientId:a.patient.id,filter:a.query,page:a.currentPage,reportType:c.reportType,searchString:c.searchString,queryType:c.queryType},{reload:!0})},2e3)})})}}]),angular.module("rippleDemonstrator").controller("ProceduresDetailCtrl",["$scope","$stateParams","SearchInput","$modal","$state","$location","Helper","usSpinnerService","PatientService","Procedure",function(a,b,c,d,e,f,g,h,i,j){c.update(),i.get(b.patientId).then(function(b){a.patient=b}),j.get(b.patientId,b.procedureId,b.source).then(function(b){a.procedure=b.data,h.stop("proceduresDetail-spinner")}),a.edit=function(){var c=d.open({templateUrl:"views/procedures/procedures-modal.html",size:"lg",controller:"ProceduresModalCtrl",resolve:{modal:function(){return{title:"Edit Procedure"}},procedure:function(){return angular.copy(a.procedure)},patient:function(){return a.patient}}});c.result.then(function(c){c.dateSubmitted=new Date(c.dateSubmitted),c.date=new Date(c.date),c.date.setMinutes(c.date.getMinutes()-c.date.getTimezoneOffset());var d={sourceId:c.sourceId,name:c.name,notes:c.notes,author:c.author,currentStatusTerminology:"local",currentStatusCode:"at0047",date:c.date,time:c.time,performer:c.performer,dateSubmitted:c.dateSubmitted,source:"openehr"};j.update(a.patient.id,d).then(function(){setTimeout(function(){e.go("procedures-detail",{patientId:a.patient.id,procedureId:g.updateId(c.sourceId),page:a.currentPage,reportType:b.reportType,searchString:b.searchString,queryType:b.queryType})},2e3)})})}}]),angular.module("rippleDemonstrator").controller("ResultsListCtrl",["$scope","$location","$stateParams","SearchInput","$modal","usSpinnerService","$state","PatientService","Result",function(a,b,c,d,e,f,g,h,i){a.currentPage=1,d.update(),a.pageChangeHandler=function(b){a.currentPage=b},c.page&&(a.currentPage=c.page),a.search=function(b){return-1!==angular.lowercase(b.testName).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.sampleTaken).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.dateCreated).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.source).indexOf(angular.lowercase(a.query)||"")},c.filter&&(a.query=c.filter),h.get(c.patientId).then(function(b){a.patient=b}),i.all(c.patientId).then(function(b){a.results=b.data;for(var c=0;c<a.results.length;c++)a.results[c].sampleTaken=moment(a.results[c].sampleTaken).format("DD-MMM-YYYY"),a.results[c].dateCreated=moment(a.results[c].dateCreated).format("DD-MMM-YYYY");f.stop("patientSummary-spinner")}),a.go=function(b){g.go("results-detail",{patientId:a.patient.id,resultIndex:b,filter:a.query,page:a.currentPage,reportType:c.reportType,searchString:c.searchString,queryType:c.queryType})},a.selected=function(a){return a===c.resultIndex}}]),angular.module("rippleDemonstrator").controller("ResultsDetailCtrl",["$scope","$stateParams","SearchInput","$modal","$location","usSpinnerService","PatientService","Result",function(a,b,c,d,e,f,g,h){c.update(),g.get(b.patientId).then(function(b){a.patient=b}),h.get(b.patientId,b.resultIndex).then(function(b){a.result=b.data,f.stop("resultsDetail-spinner")})}]),angular.module("rippleDemonstrator").controller("OrdersListCtrl",["$scope","$location","$stateParams","SearchInput","usSpinnerService","$modal","$state","PatientService","Order",function(a,b,c,d,e,f,g,h,i){d.update(),a.currentPage=1,a.pageChangeHandler=function(b){a.currentPage=b},c.page&&(a.currentPage=c.page),a.search=function(b){return-1!==angular.lowercase(b.name).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.orderDate).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.source).indexOf(angular.lowercase(a.query)||"")},c.filter&&(a.query=c.filter),h.get(c.patientId).then(function(b){a.patient=b}),i.all(c.patientId).then(function(b){if(204!==b.status){a.orders=b.data.reverse();for(var c=0;c<a.orders.length;c++)a.orders[c].orderDate=moment(a.orders[c].orderDate).format("DD-MMM-YYYY h:mm a")}e.stop("patientSummary-spinner")}),a.go=function(b){g.go("orders-detail",{patientId:a.patient.id,orderId:b,filter:a.query,page:a.currentPage,reportType:c.reportType,searchString:c.searchString,queryType:c.queryType})},a.selected=function(a){return a===c.orderId},a.create=function(){var b=f.open({templateUrl:"views/orders/orders-modal.html",size:"lg",controller:"OrdersModalCtrl",resolve:{modal:function(){return{title:"Create Orders"}},order:function(){return{}},patient:function(){return a.patient}}});b.result.then(function(b){for(var d=[],e=0;e<b.length;e++){var f={};f.sourceId="",f.dateCreated=new Date,f.author="Dr John Smith",f.code=b[e].code,f.name=b[e].text,f.source="openehr",d.push(f)}i.create(a.patient.id,d).then(function(){setTimeout(function(){g.go("orders",{patientId:a.patient.id,filter:a.query,page:a.currentPage,reportType:c.reportType,searchString:c.searchString,queryType:c.queryType},{reload:!0})},2e3)})})}}]),angular.module("rippleDemonstrator").controller("OrdersDetailCtrl",["$scope","$stateParams","SearchInput","$modal","$location","usSpinnerService","PatientService","Order",function(a,b,c,d,e,f,g,h){c.update(),g.get(b.patientId).then(function(b){a.patient=b}),h.get(b.patientId,b.orderId).then(function(b){a.order=b.data,f.stop("ordersDetail-spinner")})}]),angular.module("rippleDemonstrator").controller("OrdersModalCtrl",["$scope","$modalInstance","Order","UserService","order","patient","modal",function(a,b,c,d,e,f,g){d.findCurrentUser().then(function(b){a.currentUser=b.data;
}),a.order=e,a.patient=f,a.modal=g,a.order.author="Dr John Smith",a.firstPage=!0,a.chosenOrders=[],"Create Orders"===g.title&&(a.order.orderDate=(new Date).toISOString().slice(0,10)),c.suggestion().then(function(b){a.suggestions=b.data}),a.ok=function(c){a.formSubmitted=!0,c.$valid&&b.close(a.chosenOrders)},a.idSelectedLeft=null,a.idSelectedRight=null,a.setSelectedLeft=function(b){a.idSelectedRight=null,a.idSelectedLeft=b},a.setSelectedRight=function(b){a.idSelectedLeft=null,a.idSelectedRight=b},a.toggleSelectedItem=function(b){if(a.isInSuggestionsList(b)){a.setSelectedLeft(b);for(var c=0;c<a.suggestions.length;c++)a.suggestions[c].code===a.idSelectedLeft&&(a.chosenOrders.push(a.suggestions[c]),a.suggestions.splice(c,1))}else{a.setSelectedRight(b);for(var d=0;d<a.chosenOrders.length;d++)a.chosenOrders[d].code===a.idSelectedRight&&(a.suggestions.push(a.chosenOrders[d]),a.chosenOrders.splice(d,1))}0===a.chosenOrders.length&&(a.firstPage=!0)},a.isInSuggestionsList=function(b){for(var c=0;c<a.suggestions.length;c++)if(a.suggestions[c].code===b)return!0;return!1},a.moveItem=function(){if(null===a.idSelectedLeft)for(var b=0;b<a.chosenOrders.length;b++)a.chosenOrders[b].code===a.idSelectedRight&&(a.suggestions.push(a.chosenOrders[b]),a.chosenOrders.splice(b,1));else for(var c=0;c<a.suggestions.length;c++)a.suggestions[c].code===a.idSelectedLeft&&(a.chosenOrders.push(a.suggestions[c]),a.suggestions.splice(c,1))},a.pageTwo=function(){a.firstPage=!1},a.pageOne=function(){a.firstPage=!0},a.cancel=function(){b.dismiss("cancel")},a.openDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0}}]),angular.module("rippleDemonstrator").controller("ReportChartsCtrl",["$scope","$rootScope","$window","$modal","$state","$stateParams","Report","UserService",function(a,b,c,d,e,f,g,h){b.searchMode=!0,b.reportMode=!0,b.reportTypeSet=!0,a.resultSize=0,a.noResults="",h.findCurrentUser().then(function(b){a.currentUser=b.data});var i=function(a,b){currentUser.feature.roleConfirmationRequired?j(a,b):k(a,b)},j=function(a,b){d.open({templateUrl:"views/confirmation.html",size:"md",controller:["$scope",function(c){c.cancel=function(){c.$close(!0)},c.ok=function(){c.$close(!0),k(a,b)}}]})},k=function(a,b){var c=a.series.split("-"),d=0,f=0;2===c.length?(d=c[0],f=c[1]):(d=80,f=130),e.go("patients-list-full",{queryType:"Reports: ",ageFrom:d,ageTo:f,orderColumn:"name",orderType:"ASC",pageNumber:1,reportType:b.reportType,searchString:b.searchString})},l=function(b){c.Morris.Bar({element:"age-chart",resize:!0,data:b,ykeys:["value"],xkey:"series",labels:["Patients"],barColors:["#7E28CD"],ymin:0,ymax:46,barGap:4,barSizeRatio:.55,xLabelAngle:50,redraw:!0}).on("click",function(b,c){i(c,a.requestBody)})};if(void 0!==f.searchString){var m=f.searchString.split(":");a.reportType=m[0],a.searchString=m[1],b.reportTypeString=a.reportType,1===m.length&&e.go("patients-charts"),a.requestBody={reportType:m[0],searchString:m[1]},g.getChart(a.requestBody).then(function(b){var c=[{series:"11-18",value:b.data.agedElevenToEighteen},{series:"19-30",value:b.data.agedNineteenToThirty},{series:"31-60",value:b.data.agedThirtyOneToSixty},{series:"61-80",value:b.data.agedSixtyOneToEighty},{series:">80",value:b.data.agedEightyPlus}];a.resultSize=b.data.all,0!==a.resultSize?l(c):a.noResults="There are no results that match your search criteria"})}else e.go("patients-charts")}]),angular.module("rippleDemonstrator").controller("PatientsListFullCtrl",["$scope","$rootScope","$state","$stateParams","Report",function(a,b,c,d,e){function f(){var b=15*a.pagingInfo.page-14,c=0,d=0;d=a.pagingInfo.totalItems%15===0?a.pagingInfo.totalItems/15:Math.floor(a.pagingInfo.totalItems/15)+1,c=a.pagingInfo.page===d?b+a.pagingInfo.totalItems%15-1:15*a.pagingInfo.page;var e=b+" to "+c+" of "+a.pagingInfo.totalItems;return e}function g(){if("Setting: "===d.queryType){b.settingsMode=!0,b.reportMode=!1,b.patientMode=!1,b.subHeader=d.queryType+d.searchString;var c={searchString:d.searchString,orderType:d.orderType,pageNumber:d.pageNumber};e.getSettingsTable(c).then(function(b){a.patients=b.data.patientDetails,a.pagingInfo.totalItems=b.data.totalPatients,0===a.pagingInfo.totalItems?a.noResults="There are no results that match your search criteria":a.processData()})}else if("Reports: "===d.queryType){b.reportMode=!0,b.settingsMode=!1,b.patientMode=!1,b.reportTypeSet=!0,b.reportTypeString=d.reportType,a.subHeader=d.queryType+d.reportType+": "+d.searchString+" & Aged "+d.ageFrom+" to "+d.ageTo;var f={ageFrom:d.ageFrom,ageTo:d.ageTo,orderType:d.orderType,pageNumber:d.pageNumber,reportType:d.reportType,searchString:d.searchString};e.getTable(f).then(function(b){a.patients=b.data.patientDetails,a.pagingInfo.totalItems=b.data.totalPatients,0===a.pagingInfo.totalItems?a.noResults="There are no results that match your search criteria":a.processData()})}else{b.reportMode=!1,b.settingsMode=!1,b.reportTypeSet=!1,b.patientMode=!0,b.subHeader=d.queryType+d.searchString;var g={orderType:d.orderType,pageNumber:d.pageNumber,searchString:d.searchString};e.searchByPatient(g).then(function(b){a.patients=b.data.patientDetails,a.pagingInfo.totalItems=b.data.totalPatients,0===a.pagingInfo.totalItems?a.noResults="There are no results that match your search criteria":a.processData()})}}a.pagingInfo={page:1,totalItems:0,orderType:"ASC"},a.noResults="",a.tab="patientInfo",a.patients=[],b.searchMode=!0,a.processData=function(){for(var b=0;b<a.patients.length;b++)a.patients[b].ordersHeadline.latestEntry=a.processDateFormat(a.patients[b].ordersHeadline.latestEntry),a.patients[b].vitalsHeadline.latestEntry=a.processDateFormat(a.patients[b].vitalsHeadline.latestEntry),a.patients[b].medsHeadline.latestEntry=a.processDateFormat(a.patients[b].medsHeadline.latestEntry),a.patients[b].resultsHeadline.latestEntry=a.processDateFormat(a.patients[b].resultsHeadline.latestEntry),a.patients[b].treatmentsHeadline.latestEntry=a.processDateFormat(a.patients[b].treatmentsHeadline.latestEntry),a.patients[b].ordersHeadline.totalEntries=a.processCounts(a.patients[b].ordersHeadline.totalEntries),a.patients[b].vitalsHeadline.totalEntries=a.processCounts(a.patients[b].vitalsHeadline.totalEntries),a.patients[b].medsHeadline.totalEntries=a.processCounts(a.patients[b].medsHeadline.totalEntries),a.patients[b].resultsHeadline.totalEntries=a.processCounts(a.patients[b].resultsHeadline.totalEntries),a.patients[b].treatmentsHeadline.totalEntries=a.processCounts(a.patients[b].treatmentsHeadline.totalEntries);a.pagingInfo.orderType=d.orderType,a.pagingInfo.page=d.pageNumber,a.pageInfoText=f()},a.orderBy=function(){return"ASC"===a.pagingInfo.orderType?"sort-asc":"sort-desc"},a.sort=function(){"ASC"===d.orderType?d.orderType="DESC":d.orderType="ASC",d.pageNumber=1,g()},a.processCounts=function(a){return null===a?0:a},a.processDateFormat=function(a){return null===a?"N/A":(a=moment(a),moment().diff(a,"days")<1?a.format("h:mm a"):moment().startOf("year")<=a?a.format("DD-MMM"):moment().startOf("year").subtract(1,"year")<a?a.format("MMM-YY"):a.format("YYYY"))},a.viewPatients=function(){a.tab="patientInfo"},a.viewDateTime=function(){a.tab="dateTime"},a.viewCounts=function(){a.tab="counts"},a.$watch("pagingInfo.page",function(b){a.pagingInfo.page=b,d.pageNumber=b,g()}),a.clickGetItem=!1,a.go=function(b){a.clickGetItem||c.go("patients-summary",{patientId:b.nhsNumber,ageFrom:d.ageFrom,ageTo:d.ageTo,orderType:d.orderType,pageNumber:d.pageNumber,reportType:d.reportType,searchString:d.searchString,queryType:d.queryType}),a.clickGetItem=!1},a.goToSection=function(b,e){a.clickGetItem=!0;var f={patientId:e,ageFrom:d.ageFrom,ageTo:d.ageTo,orderType:d.orderType,pageNumber:d.pageNumber,reportType:d.reportType,searchString:d.searchString,queryType:d.queryType},g="";switch(b){case"orders":g="orders";break;case"results":g="results";break;case"procedures":g="procedures";break;case"medications":g="medications"}c.go(g,f)},a.getItem=function(b,e,f){a.clickGetItem=!0;var g={patientId:e,ageFrom:d.ageFrom,ageTo:d.ageTo,orderType:d.orderType,pageNumber:d.pageNumber,reportType:d.reportType,searchString:d.searchString,queryType:d.queryType},h="";switch(b){case"orders":g.orderId=f,h="orders-detail";break;case"results":g.resultIndex=f,h="results-detail";break;case"procedures":g.procedureId=f,h="procedures-detail";break;case"medications":g.medicationIndex=f,h="medications-detail"}c.go(h,g)},g()}]),angular.module("rippleDemonstrator").controller("ImageListCtrl",["$scope","$location","$stateParams","SearchInput","$modal","usSpinnerService","$state","PatientService","Image",function(a,b,c,d,e,f,g,h,i){a.currentPage=1,d.update(),a.pageChangeHandler=function(b){a.currentPage=b},c.page&&(a.currentPage=c.page),a.search=function(b){return-1!==angular.lowercase(b.studyDescription).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.dateRecorded).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.source).indexOf(angular.lowercase(a.query)||"")},c.filter&&(a.query=c.filter),h.get(c.patientId).then(function(b){a.patient=b}),i.allStudies(c.patientId).then(function(b){a.images=b.data;for(var c=0;c<a.images.length;c++){var d=a.images[c];d.dateRecorded=moment(d.dateRecorded).format("DD-MMM-YYYY"),(null===d.studyDescription||""===d.studyDescription)&&(d.studyDescription="N/A")}f.stop("imagesList-spinner")}),a.go=function(b,d){g.go("images-detail",{patientId:a.patient.id,studyId:b,source:d,filter:a.query,page:a.currentPage,reportType:c.reportType,searchString:c.searchString,queryType:c.queryType})},a.selected=function(a){return a===c.studyId}}]),angular.module("rippleDemonstrator").controller("ImageDetailCtrl",["$scope","$stateParams","SearchInput","$location","$modal","Helper","$state","usSpinnerService","PatientService","Image",function(a,b,c,d,e,f,g,h,i,j){c.update(),i.get(b.patientId).then(function(b){a.patient=b}),a.series=[],j.getAllSeriesInStudy(b.patientId,b.studyId,b.source).then(function(b){a.study=b.data;var c=a.study.seriesIds;a.instanceIds=[];for(var d=0;d<c.length;d++)l(c[d],d),k(c[d],d)});var k=function(c,d){j.getInstanceId(b.patientId,c,b.source).then(function(b){a.instanceIds[d]=b.data.instanceId})},l=function(c,d){j.getSeriesDetails(b.patientId,c).then(function(b){a.series[d]=b.data,a.series[d].seriesDate=moment(a.series[d].seriesDate).format("DD-MMM-YYYY"),a.series[d].seriesTime=moment(a.series[d].seriesTime).format("h:mma")})};a.stopSpinner=function(a){h.stop(a)},a.openImage=function(c){e.open({templateUrl:"views/dicom/image-modal.html",size:"lg",controller:"ImageModalCtrl",resolve:{modal:function(){return{title:"View Dicom Image"}},dicomImageId:function(){return c},seriesId:function(){return j.getInstance(b.patientId,c).then(function(a){return a.data.parentSeries})},series:function(){return a.series},patient:function(){return a.patient}}})}}]),angular.module("rippleDemonstrator").controller("ImageModalCtrl",["$scope","$modalInstance","UserService","dicomImageId","patient","modal",function(a,b,c,d,e,f){c.findCurrentUser().then(function(b){a.currentUser=b.data}),a.patient=e,a.modal=f,a.dicomId=d,a.ok=function(){b.close()}}]),angular.module("rippleDemonstrator").controller("InformationGovernanceCtrl",["$scope","$location","$stateParams","SearchInput","$modal","$state","$filter","usSpinnerService","UserService","PatientService","InformationGovernance",function(a,b,c,d,e,f,g,h,i,j,k){a.currentPage=1,d.update(),i.findCurrentUser().then(function(b){a.currentUser=b.data,c.patientSource=a.currentUser.feature.patientSource}),a.pageChangeHandler=function(b){a.currentPage=b},a.search=function(b){return-1!==angular.lowercase(g("optedIn")(b.optIn)).indexOf(angular.lowercase(a.query)||"")},c.page&&(a.currentPage=c.page),c.filter&&(a.query=c.filter),j.get(c.patientId,c.patientSource).then(function(b){a.patient=b}),k.all(c.patientId).then(function(b){a.consents=b.data;for(var c=0;c<a.consents.length;c++)a.consents[c].dateCreated=new Date(a.consents[c].dateCreated).toISOString();h.stop("info-gov-spinner")}),a.go=function(b){f.go("informationgov-detail",{patientId:a.patient.nhsNumber,consentId:b,filter:a.query,page:a.currentPage,reportType:c.reportType,searchString:c.searchString,queryType:c.queryType})},a.selected=function(a){return a===c.consentId},a.create=function(){var b=e.open({templateUrl:"views/information-governance/information-governance-modal.html",size:"lg",controller:"InformationGovernanceModalCtrl",resolve:{modal:function(){return{title:"Create Information Governance"}},consent:function(){return{optIn:!a.patient.optIn}},patient:function(){return a.patient}}});b.result.then(function(b){var d={sourceId:b.sourceId,optIn:b.optIn,reason:b.reason,author:b.author,dateCreated:b.dateCreated};k.create(a.patient.nhsNumber,d).then(function(){setTimeout(function(){f.go("informationgov",{patientId:a.patient.nhsNumber,filter:a.query,page:a.currentPage,reportType:c.reportType,searchString:c.searchString,queryType:c.queryType},{reload:!0})},2e3)})})}}]),angular.module("rippleDemonstrator").controller("InformationGovernanceModalCtrl",["$scope","$modalInstance","consent","UserService","patient","modal",function(a,b,c,d,e,f){d.findCurrentUser().then(function(b){a.currentUser=b.data}),a.consent=c,a.patient=e,a.modal=f,a.optChoices=[c.optIn],"Create Information Governance"===f.title?a.consent.dateCreated=(new Date).toISOString():a.consent.dateCreated=new Date(a.consent.dateCreated).toISOString(),a.consent.author=a.currentUser.givenName+" "+a.currentUser.familyName,a.ok=function(c,d){a.formSubmitted=!0,c.$valid&&b.close(d)},a.cancel=function(){b.dismiss("cancel")},a.openDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0}}]),angular.module("rippleDemonstrator").controller("InformationGovernanceDetailCtrl",["$scope","$stateParams","SearchInput","$modal","$state","$location","Helper","usSpinnerService","UserService","PatientService","InformationGovernance",function(a,b,c,d,e,f,g,h,i,j,k){c.update(),i.findCurrentUser().then(function(c){a.currentUser=c.data,b.patientSource=a.currentUser.feature.patientSource}),j.get(b.patientId,b.patientSource).then(function(b){a.patient=b}),k.get(b.patientId,b.consentId).then(function(b){a.consent=b.data,h.stop("info-gov-spinner")}),a.edit=function(){var c=d.open({templateUrl:"views/information-governance/information-governance-modal.html",size:"lg",controller:"InformationGovernanceModalCtrl",resolve:{modal:function(){return{title:"Edit Information Governance"}},consent:function(){return angular.copy(a.consent)},patient:function(){return a.patient}}});c.result.then(function(c){var d={sourceId:c.sourceId,optIn:c.optIn,reason:c.reason,author:c.author,dateCreated:c.dateCreated};k.update(a.patient.nhsNumber,d).then(function(){setTimeout(function(){e.go("informationgov-detail",{patientId:a.patient.nhsNumber,consentIndex:c.sourceId,page:a.currentPage,reportType:b.reportType,searchString:b.searchString,queryType:b.queryType},{reload:!0})},2e3)})})}}]),angular.module("rippleDemonstrator").controller("MainSearchController",["$scope","$state","AdvancedSearch","Helper",function(a,b,c,d){a.searchExpression="",a.openAdvancedSearch=c.openAdvancedSearch,a.searchFunction=function(){a.searchExpression.length>0&&!isNaN(a.searchExpression)&&c.searchByDetails({nhsNumber:a.searchExpression}).then(function(b){a.patients=b.data,e()})},a.checkExpression=function(b){!d.containsKeyCode(b.keyCode)&&a.searchExpression.length>0&&/^(?!.*[0-9])/.test(a.searchExpression)&&c.openAdvancedSearch(a.searchExpression)};var e=function(){a.formSubmitted=!0,1==a.patients.length?b.go("patients-summary",{patientId:a.patients[0].nhsNumber}):a.patients.length>1?b.go("patients-list",{patientsList:a.patients,advancedSearchParams:a.searchParams}):b.go("patients-list",{patientsList:a.patients,advancedSearchParams:a.searchParams,displayEmptyTable:!0})}}]),angular.module("rippleDemonstrator").controller("AdvancedSearchController",["$scope","$modalInstance","$state","modal","searchParams","AdvancedSearch",function(a,b,c,d,e,f){a.modal=d,a.searchParams=e,a.formSubmitted=!1,a.detailsFocused=!1,a.modalReopened=!1,a.searchParams.nhsNumber?a.nhsNumberFocus=!0:a.searchParams.surname?a.surnameFocus=!0:a.nhsNumberFocus=!0,a.searchParams.dateOfBirth&&(a.searchParams.dateOfBirth=new Date(a.searchParams.dateOfBirth).toISOString().slice(0,10),a.detailsFocused=!0,a.modalReopened=!0),a.cancel=function(){b.dismiss("cancel")},a.ok=function(b){b.$valid&&f.searchByDetails(a.searchParams).then(function(b){a.patients=b.data,g()})};var g=function(){a.formSubmitted=!0,b.close(),1==a.patients.length?c.go("patients-summary",{patientId:a.patients[0].nhsNumber}):a.patients.length>1?c.go("patients-list",{patientsList:a.patients,advancedSearchParams:a.searchParams}):c.go("patients-list",{patientsList:a.patients,advancedSearchParams:a.searchParams,displayEmptyTable:!0})};a.openDatePicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.isNhsNumberRequired=function(b){var c=a.advancedSearchForm.nhsNumber.$viewValue;if(void 0===c&&a.areDetailsFieldsClean(b))return!0;c&&(c=c.replace(/\s+/g,""));var d=isNaN(c)||b.nhsNumber.$invalid&&0===c.length;return d&&a.areDetailsFieldsClean(b)},a.isNhsNumberTooShort=function(a){if(void 0===a)return!1;var b=a.replace(/\s+/g,"");return!isNaN(b)&&b.length>0&&b.length<10},a.isNhsNumberTooLong=function(a){if(void 0===a)return!1;var b=a.replace(/\s+/g,"");return!isNaN(b)&&b.length>10},a.isNhsNumberFieldInvalid=function(a){return a.$invalid||a.$pristine},a.areDetailsFieldsClean=function(b){var c=b.surname,d=b.forename,e=b.dateOfBirth,f=c.$invalid||!a.searchParams.surname||""==a.searchParams.surname,g=d.$invalid||!a.searchParams.forename||""==a.searchParams.forename,h=e.$invalid||!a.searchParams.dateOfBirth||""==a.searchParams.dateOfBirth;return f&&g&&h}}]),angular.module("rippleDemonstrator").controller("AuditListCtrl",["$rootScope","$scope","$location","$stateParams","SearchInput","$modal","$state","usSpinnerService","AuditService",function(a,b,c,d,e,f,g,h,i){function j(a){i.countByPatient(b.searchTerm).then(function(a){b.totalAudits=a.data}),h.spin("auditSummary-spinner"),i.allByPatient(b.searchTerm,a).then(function(a){b.audits=a,h.stop("auditSummary-spinner")})}function k(a){i.countByUsername(b.searchTerm).then(function(a){b.totalAudits=a.data}),h.spin("auditSummary-spinner"),i.allByUsername(b.searchTerm,a).then(function(a){b.audits=a,h.stop("auditSummary-spinner")})}e.update(),b.pageChangeHandler=function(a){b.currentPage=a},b.auditsPerPage=15,b.totalAudits=0;var l=1;b.pagination={current:1},b.onSearchByPatient=function(a){j(l)},b.onSearchByUsername=function(a){k(l)},b.onPatientPageChanged=function(a){j(a)},b.onUsernamePageChanged=function(a){k(a)},b.go=function(b){a.$broadcast("audits:get-audit",{auditId:b})}}]),angular.module("rippleDemonstrator").controller("AuditDetailCtrl",["$scope","$stateParams","SearchInput","usSpinnerService","AuditService",function(a,b,c,d,e){c.update(),a.init=function(){void 0!==b.auditId&&a.getAudit(b.auditId)},a.getAudit=function(b){d.spin("auditDetail-spinner"),e.get(b).then(function(b){a.audit=b,d.stop("auditDetail-spinner")})},a.$on("audits:get-audit",function(b,c){a.getAudit(c.auditId)})}]),angular.module("rippleDemonstrator").controller("AdminCtrl",["$scope","$state","SearchInput","UserService",function(a,b,c,d){c.update(),d.findCurrentUser().then(function(b){a.adminUser=b.data}),a.goTo=function(a){var c="";switch(a){case"adminConsole":c="admin-console"}b.go(c)}}]),angular.module("rippleDemonstrator").controller("NotificationsCtrl",["$scope","$rootScope","Notifications",function(a,b,c){a.acknowledge=function(b){c.acknowledge(b).then(function(){for(var c=0;c<a.notifications.length;c++)b===a.notifications[c].source&&a.notifications.splice(c,1)})},a.updateNotifications=function(b){a.notifications=b.data;for(var c=0;c<a.notifications.length;c++)a.notifications[c].timeCreated=moment(a.notifications[c].timeCreated).fromNow()},c.all().then(a.updateNotifications),b.$on("$stateChangeSuccess",function(b,d){c.all().then(a.updateNotifications)})}]),angular.module("rippleDemonstrator").controller("AlertsListCtrl",["$scope","$location","$stateParams","$modal","$state","usSpinnerService","PatientService","AlertService",function(a,b,c,d,e,f,g,h){a.currentPage=1,a.pageChangeHandler=function(b){a.currentPage=b},c.page&&(a.currentPage=c.page),a.search=function(b){return-1!==angular.lowercase(b.alertType).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.source).indexOf(angular.lowercase(a.query)||"")},c.filter&&(a.query=c.filter),g.get(c.patientId).then(function(b){a.patient=b}),h.findAllSummaries(c.patientId).then(function(b){a.alerts=b.data;for(var c=0;c<a.alerts.length;c++)a.alerts[c].dateTime=moment(a.alerts[c].dateTime).format("DD-MMM-YYYY h:mm a");f.stop("patientSummary-spinner")}),a.go=function(b){e.go("alerts-detail",{patientId:a.patient.nhsNumber,alertId:b,filter:a.query,page:a.currentPage})},a.selected=function(a){return a===c.alertId},a.create=function(){var b=d.open({templateUrl:"views/alerts/alerts-modal.html",size:"lg",controller:"AlertsModalCtrl",resolve:{modal:function(){return{title:"Create Alert"}},alert:function(){return{}},patient:function(){return a.patient}}});b.result.then(function(b){var c={type:b.type,note:b.note,date:b.dateTime,author:b.author};h.create(a.patient.id,c).then(function(){setTimeout(function(){e.go("alerts",{patientId:a.patient.id,filter:a.query,page:a.currentPage},{reload:!0})},2e3)})})}}]),angular.module("rippleDemonstrator").controller("AlertsDetailCtrl",["$scope","$stateParams","$modal","$state","$location","usSpinnerService","PatientService","AlertService",function(a,b,c,d,e,f,g,h){g.get(b.patientId).then(function(b){a.patient=b}),h.findDetails(b.patientId,b.alertId).then(function(b){a.alert=b.data,f.stop("alertsDetail-spinner")}),a.edit=function(){var b=c.open({templateUrl:"views/alerts/alerts-modal.html",size:"lg",controller:"AlertsModalCtrl",resolve:{modal:function(){return{title:"Edit Alert"}},alert:function(){return angular.copy(a.alert)},patient:function(){return a.patient}}});b.result.then(function(b){var c={source:b.source,sourceId:b.sourceId,type:b.alertType,note:b.alertNote,date:b.dateTime,author:b.author};h.update(a.patient.id,c).then(function(){setTimeout(function(){d.go("alerts-detail",{patientId:a.patient.id,alertId:b.sourceId,page:a.currentPage})},2e3)})})}}]),angular.module("rippleDemonstrator").controller("AlertsModalCtrl",["$scope","$modalInstance","UserService","patient","alert","modal",function(a,b,c,d,e,f){a.currentUser=c.getCurrentUser(),a.alert=e,a.patient=d,a.modal=f,"Create Alert"===f.title?a.alert.date=(new Date).toISOString().slice(0,10):a.alert.date=new Date(a.alert.date).toISOString().slice(0,10),a.ok=function(c,d){a.formSubmitted=!0,c.$valid&&b.close(d)},a.cancel=function(){b.dismiss("cancel")},a.openDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0}}]);